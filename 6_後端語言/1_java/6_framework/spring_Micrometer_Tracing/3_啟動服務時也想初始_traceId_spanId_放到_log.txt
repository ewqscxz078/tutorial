Micrometer Tracing é è¨­åªæœƒåœ¨ è™•ç†è«‹æ±‚ï¼ˆHTTP Server æˆ– WebClient ç­‰ï¼‰ çš„æ™‚å€™ï¼Œ
	è‡ªå‹•å»ºç«‹å’Œç®¡ç† traceId / spanIdï¼Œä¹ŸæœƒæŠŠå®ƒå€‘æ”¾åˆ° MDCï¼ˆMapped Diagnostic Contextï¼‰ä¸­ï¼Œ
	è®“ä½ åœ¨ logback pattern ä¸­ä½¿ç”¨ %X{traceId} %X{spanId} å–å¾—


é è¨­ã€Œä¸æœƒã€å¹«ä½ åœ¨ Spring Boot æ‡‰ç”¨å•Ÿå‹•éšæ®µç”¢ç”Ÿ traceId / spanIdã€‚
	å› ç‚ºé‚£å€‹éšæ®µä¸å±¬æ–¼ä¸€å€‹è¢«è§€å¯Ÿçš„è«‹æ±‚æˆ–ä»»å‹™ä¸Šä¸‹æ–‡ï¼ˆå¦‚ HTTP Request æˆ– Scheduled Taskï¼‰

âœ… ã€Œå•Ÿå‹•æœå‹™æ™‚ä¹Ÿæƒ³åˆå§‹ traceId spanId æ”¾åˆ° logã€
	âœ… è§£æ³•1 ï¼šæ‰‹å‹•å»ºç«‹ä¸€å€‹ span context æ”¾å…¥ MDCï¼Œä½¿ç”¨è¼ƒåº•å±¤çš„ Tracer
		ä½ å¯ä»¥åœ¨ ApplicationRunner æˆ– CommandLineRunner è£¡æ‰‹å‹•å»ºç«‹ä¸€å€‹ spanï¼Œä¾‹å¦‚ï¼š

			import io.micrometer.tracing.Span;
			import io.micrometer.tracing.Tracer;

			@Component
			public class StartupTracer implements ApplicationRunner {

				private final Tracer tracer;

				public StartupTracer(Tracer tracer) {
					this.tracer = tracer;
				}

				@Override
				public void run(ApplicationArguments args) {
					Span span = this.tracer.nextSpan().name("app-startup").start();
					try (Tracer.SpanInScope ws = this.tracer.withSpan(span)) {
						// å°‡ traceId / spanId åŠ åˆ° MDC çš„æ˜¯ Micrometer è‡ªå‹•å¹«ä½ åšçš„
						log.info("Application started with tracing span.");
					} finally {
						span.end();
					}
				}
			}
	âœ… è§£æ³•2 ï¼š ä½¿ç”¨æ¨è–¦çš„ ObservationRegistry.Observation
		@Component
		public class MyStartupLogger implements ApplicationRunner {

			private final ObservationRegistry observationRegistry;

			public MyStartupLogger(ObservationRegistry observationRegistry) {
				this.observationRegistry = observationRegistry;
			}

			@Override
			public void run(ApplicationArguments args) {
				Observation observation = Observation
					.start("app-startup", observationRegistry)
					.lowCardinalityKeyValue("taskCode", "BOOT001")
					.lowCardinalityKeyValue("env", "prod");

				try (Observation.Scope scope = observation.openScope()) {
					log.info("å•Ÿå‹•æœå‹™ä¸­ï¼Œä½¿ç”¨ Observation è‡ªå‹•åŠ å…¥ MDC");
				} finally {
					observation.stop(); // è‡ªå‹•ç§»é™¤ MDC
				}
			}
		}


ğŸ” å»¶ä¼¸ï¼šå¦‚æœä½ æœ‰å…¶ä»–é HTTP çš„å·¥ä½œä¹Ÿå¸Œæœ›è‡ªå‹•æœ‰ traceIdï¼Œæ¯”å¦‚ï¼š
	@Scheduled
	Kafka Listener
	CommandLineRunner

	ä½ éƒ½è¦åœ¨é€™äº›å·¥ä½œé–‹å§‹æ™‚æ‰‹å‹•å»ºç«‹ Spanï¼Œæˆ–ä½¿ç”¨ Micrometer æä¾›çš„ ObservationRegistry è‡ªå‹•è§€å¯Ÿç¯„åœã€‚


âœ… å»ºè­°çµè«–ï¼š
	è‹¥åªæ˜¯ç´” trace æ§åˆ¶ï¼š ä½¿ç”¨ Tracer + withSpan() ä¹Ÿ OKã€‚

	è‹¥ä½ æƒ³åšåˆ°ï¼šlogï¼ˆMDCï¼‰ã€tracingã€metricsã€context æ•´åˆã€å»¶ä¼¸å¯è§€æ¸¬æ€§å¹³å°ï¼ˆå¦‚ Tempo/Prometheusï¼‰ï¼š
		ğŸ‘‰ å¼·çƒˆå»ºè­°çµ±ä¸€æ”¹ç”¨ ObservationRegistryï¼


âœ… ä½¿ç”¨ ObservationRegistry ç°¡è¦çµè«–
	| æ–¹æ³•                                               | å›å‚³çš„æ˜¯ï¼Ÿ                              | ä½¿ç”¨æ™‚æ©Ÿ                             |
	| -------------------------------------------------- | --------------------------------------- | ------------------------------------ |
	| `observationRegistry.getCurrentObservation()`      | ç›®å‰ä½œç”¨ä¸­çš„ `Observation` æœ¬é«”         | è¦ä¿®æ”¹ã€è§€å¯Ÿæˆ–å»¶ä¼¸ç¾æœ‰ Observation   |
	| `observationRegistry.getCurrentObservationScope()` | åŒ…å« `Observation` çš„ `Scope` åŒ…è£ç‰©ä»¶  | é€²éšç”¨é€”ï¼Œä¾‹å¦‚è·¨åŸ·è¡Œç·’ä¿å­˜æˆ–é—œ scope |

	è¨»å†Š ObservationRegistry

	ä¸€èˆ¬ä½¿ç”¨
		Observation observation = observationRegistry.getCurrentObservation();
		if (observation != null) {
			observation.lowCardinalityKeyValue("userId", "u123");
		}

	è·¨åŸ·è¡Œç·’ä½¿ç”¨
		Observation.Scope originalScope = observationRegistry.getCurrentObservationScope();
		Runnable task = () -> {
			try (Observation.Scope scope = originalScope) {
				log.info("æˆ‘å¯ä»¥è·¨åŸ·è¡Œç·’å­˜å– context");
			}
		};