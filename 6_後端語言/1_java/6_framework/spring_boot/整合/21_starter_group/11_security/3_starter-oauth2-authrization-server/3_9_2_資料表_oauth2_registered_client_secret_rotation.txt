CREATE TABLE oauth2_client_secret ( --  client secret 歷史紀錄
  issuer          VARCHAR(200) NOT NULL,
  rc_id           VARCHAR(100) NOT NULL,
  ver             INTEGER      NOT NULL,          -- 1,2,3…（版本序號）
  secret_hash     VARCHAR(200) NOT NULL,
  issued_at       TIMESTAMP    NOT NULL,          -- 生效時間（UTC）
  expires_at      TIMESTAMP    NULL,              -- 到期（UTC）
  disabled_at     TIMESTAMP    NULL,              -- 停用（UTC）
  grace_until     TIMESTAMP    NULL,              -- 舊版可用到（UTC）
  state           SMALLINT     NOT NULL,          -- 0=INACTIVE,1=ACTIVE,2=PREV_ACTIVE,9=COMPROMISED
  created_at      TIMESTAMP    NOT NULL,
  updated_at      TIMESTAMP    NOT NULL,

  CONSTRAINT PK_oauth2_client_secret PRIMARY KEY (issuer, rc_id, ver),
  -- CONSTRAINT FK_secret_parent FOREIGN KEY (issuer, rc_id)
  --   REFERENCES oauth2_registered_client (issuer, rc_id)
);
CREATE INDEX IX_oauth2_secret_active
  ON oauth2_client_secret (issuer, rc_id, state);
