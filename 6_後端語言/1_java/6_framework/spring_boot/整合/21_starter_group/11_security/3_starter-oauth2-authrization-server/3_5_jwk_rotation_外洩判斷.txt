ref ChatGPT

在 JWK rotation 概念裡
	1.正常情境是定期（比如 30 天、90 天）換一把新金鑰，把舊金鑰退役（inactive），並保留一段時間讓現有存活的 JWT 還能驗證。這是「良性輪替」。
	2.提到的 撤銷 (revocation)，是屬於「非預期」的應急事件，表示懷疑金鑰 外洩 (compromise) 或不可信，這種情況要立即撤銷。

那什麼時候會知道金鑰外洩，需要撤銷呢？常見有幾種判斷來源：

	1. 內部事件通報
		* 開發/營運人員誤操作：不小心把 private key 或 PEM/JWK 明文推到 GitHub、GitLab、SVN 等公開 repo（常見）。
		* 配置錯誤：例如把私鑰掛在公開對外的 API 上，或是誤掛到容器鏡像（Docker image）中。
			➡️ 這種通常透過 安全掃描 (secret scanner) 或 DevOps pipeline 檢測出來。
	
	2. 安全監控/入侵偵測
		* 伺服器被入侵：系統被黑客入侵，攻擊者可能存取到存放金鑰的檔案系統或資料庫。
		* 異常存取紀錄：例如 HSM/KMS/Vault API 有異常的請求量、異常來源 IP。
		* SIEM / IDS / EDR 告警：安全監控工具發現有可疑動作，觸發金鑰外洩疑慮。

	3. 行為異常
		* JWT 驗證異常：例如資源伺服器收到帶著 已不存在於 JWKS 的 kid，但仍能被驗證成功 → 可能表示舊金鑰被盜用並簽發了假 Token。
		* 流量特徵異常：突然出現大量未知來源、卻能正確帶著合法簽章的 JWT。

	4. 外部通報
		* 威脅情報 (Threat Intelligence)：外部安全單位通報某金鑰在暗網流傳。
		* 第三方服務商通知：如果你的 Auth server 與第三方系統整合，他們可能會警告「你們的 key 疑似被濫用」。

	5. 主動檢測機制
		* 有些組織會定期對關鍵資產做 秘密外洩掃描 (leak detection)，例如在 GitHub/GitLab、Pastebin、暗網論壇找關鍵字。
		* 一旦發現私鑰外流，就必須馬上標記為 COMPROMISED 並撤銷。

撤銷後要做的事

	* 立刻移除該 JWK 從公開 JWKS（讓所有 Resource Server 拒絕舊 Token）。

	* 加入 denylist（黑名單），即使資源伺服器本地有快取，也要能識別該 kid 或 jti（token id）已失效。

	* 強制 refresh JWKS cache，避免資源伺服器還用舊快取。

	* 全域告警/通報，讓下游系統知道某把金鑰不可信。

	* 審核日誌 & forensics，查出外洩途徑。

👉 總結：
	「撤銷」不是輪替的一部分，而是安全事件回應。
	通常來自 DevOps 誤操作外洩、系統入侵、JWT 異常行為 或 外部通報，一旦懷疑外洩就要立刻撤銷，不等到原本的輪替週期。