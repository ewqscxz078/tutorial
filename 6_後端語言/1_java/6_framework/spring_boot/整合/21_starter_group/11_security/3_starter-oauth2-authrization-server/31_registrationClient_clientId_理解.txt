ref ChatGPT

auth server registrationClient.clientId ç†è§£

å‡è¨­æƒ…å¢ƒ
	A1 + jwt ç¶“ gateway é©—è­‰ è½‰ç™¼åˆ° B
	A2 + jwt ç¶“ gateway é©—è­‰ è½‰ç™¼åˆ° B
	A3 + jwt ç¶“ gateway é©—è­‰ è½‰ç™¼åˆ° B
		å‰‡ é€™ä¸‰å€‹æ¡ˆä¾‹ç”¨çš„ clientId éƒ½ä¸åŒ
		æ‰€ä»¥ç”¨çš„ token ä¹Ÿä¸åŒï¼Œé›–ç„¶æœ€å¾Œéƒ½æ˜¯åˆ° B

	| å‘¼å«æ–¹   | èª°å» AS å– token | JWT è£¡çš„ `client_id` | JWT çš„ `aud`ï¼ˆè³‡æºï¼‰ | Gateway é©—è­‰çµæœ | å‚™è¨»               |
	| ------ | -------------- | ------------------- | ----------------- | -------------- | ---------------- |
	| A1 â†’ B | A1             | `a1-client`         | `api://b`         | é€šé (valid)    | A1 token åªèƒ½ä»£è¡¨ A1 |
	| A2 â†’ B | A2             | `a2-client`         | `api://b`         | é€šé (valid)    | A2 token åªèƒ½ä»£è¡¨ A2 |
	| A3 â†’ B | A3             | `a3-client`         | `api://b`         | é€šé (valid)    | A3 token åªèƒ½ä»£è¡¨ A3 |

å› æ­¤ï¼š
	* æ¯å€‹ clientï¼ˆA1/A2/A3ï¼‰ éƒ½è¦åœ¨ Auth Server è¨»å†Šè‡ªå·±çš„ RegisteredClientã€‚
	* å„è‡ªå–å¾—çš„ Access Token é›–ç„¶éƒ½èƒ½æ‰“åˆ°åŒä¸€å€‹è³‡æºç³»çµ± Bï¼ˆå› ç‚º aud ä¸€æ¨£ï¼‰ï¼Œä½†å½¼æ­¤çš„ token ä¸èƒ½æ··ç”¨ã€‚
	* Gateway åªè² è²¬é©—ç°½ã€æª¢æŸ¥ aud æ˜¯å¦ç¬¦åˆã€Œè¦è½‰ç™¼çš„ç›®çš„ Bã€ï¼Œå†è½‰ç™¼è«‹æ±‚ã€‚

ğŸ” å»¶ä¼¸è£œå…… â€” Token Exchange (å¦‚æœä½  Gateway è¦ä»£æ› token)
	è‹¥ Gateway ä¸åªæ˜¯é©—è­‰ï¼Œè€Œæ˜¯ã€Œå¹« A1/A2/A3 å„è‡ªä»£æ›ä¸€é¡† token çµ¦ Bã€ï¼š
		| å‘¼å«æ–¹ | A1â†’GWâ†’AS(Token Exchange) | æ–° token çš„ `client_id` | æ–° token çš„ `act` (æˆ– `azp`) | `aud`     |
		| --- | ------------------------ | --------------------- | ------------------------- | --------- |
		| A1  | GW ä»£æ›                    | `gw-c2p-te`           | `a1-client`               | `api://b` |
		| A2  | GW ä»£æ›                    | `gw-c2p-te`           | `a2-client`               | `api://b` |
		| A3  | GW ä»£æ›                    | `gw-c2p-te`           | `a3-client`               | `api://b` |

	é€™æ¨£ï¼š
		* Gateway è‡ªå·±åªæœ‰ä¸€å€‹ client_id = gw-c2p-teã€‚
		* Token è£¡çš„ act.client_id æˆ– azp æ¨™è¨˜åŸå‘¼å«è€…ï¼ˆA1/A2/A3ï¼‰ã€‚
		* B ç«¯è‹¥æƒ³çŸ¥é“æ˜¯å“ªå€‹ä¸Šæ¸¸ç³»çµ±ï¼Œå¯å¾ act è§£æå‡ºä¾†ã€‚

çµè«–ï¼š
	* è‹¥åªæ˜¯ã€ŒGateway é©—ç°½å¾Œè½‰ç™¼ã€â†’ å„ A è‡ªå–å„çš„ token (client_id=Aâ‚™)ã€‚
	* è‹¥ã€ŒGateway ä»£æ› Token Exchangeã€â†’ Gateway æœ‰è‡ªå·±çš„ client (client_id=gw)ï¼ŒAâ‚™ è¢«è¨˜éŒ„åœ¨ act æˆ– azpã€‚


clientId å»ºè­°å‘½åæ¨¡æ¿
	<zone>-svc-<caller>-to-<audAlias>
		* zoneï¼šcï¼ˆcloudï¼‰ã€pï¼ˆpremï¼‰ã€peï¼ˆprem-edgeï¼‰â€¦
		* svcï¼šè§’è‰²ï¼ˆæœå‹™/æ‰¹æ¬¡/äººæ©Ÿâ€¦ï¼‰ï¼Œå¸¸è¦‹å¯ç”¨ svcã€batchã€uiã€‚
		* callerï¼šå‘¼å«æ–¹ç³»çµ±ä»£è™Ÿï¼ˆa1 / a2 / a3ï¼‰ã€‚
		* audAliasï¼šè³‡æº B çš„åˆ¥åï¼ˆb / orders / billing â€¦ï¼‰ï¼Œä¸æ˜¯å®Œæ•´ URIã€‚

	å°æ‡‰ä¸Šé¢ä¸‰å€‹ä¾‹å­
		* c-svc-a1-to-b
		* c-svc-a2-to-b
		* c-svc-a3-to-b