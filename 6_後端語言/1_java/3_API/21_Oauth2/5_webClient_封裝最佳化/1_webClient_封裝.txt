ref ChatGPT

æŠŠ WebClientã€Œå°è£å¾—åƒ FeignClient ä¸€æ¨£ã€

ğŸ¯ æ ¸å¿ƒåšæ³•ï¼š
	ç”¨ã€Œä»‹é¢ + å¯¦ä½œé¡ + WebClientã€å°è£æˆé¡ä¼¼ FeignClient çš„é¢¨æ ¼
	âœ… å¤–è§€åƒ Feignï¼Œä½†åº•å±¤æ˜¯ WebClientï¼Œä¿æœ‰ streamingã€header æ§åˆ¶ã€éŒ¯èª¤æ””æˆªç­‰å½ˆæ€§

âœ… å°è£ WebClient åƒ FeignClient çš„ç¯„ä¾‹
	ğŸ“ Step 1: å®šç¾©ä½ çš„ä»‹é¢ï¼ˆåƒ Feignï¼‰
		public interface FileApiClient {
			UserResponse getUser(String id);
			Resource downloadFile(String fileId);
		}

	ğŸ“ Step 2: ç”¨ WebClient è‡ªè¡Œå¯¦ä½œ
		@Service
		public class FileApiClientImpl implements FileApiClient {

			private final WebClient webClient;

			public FileApiClientImpl(WebClient.Builder builder) {
				this.webClient = builder
					.baseUrl("http://file-service:8080")
					.build();
			}

			@Override
			public UserResponse getUser(String id) {
				return webClient.get()
					.uri("/api/users/{id}", id)
					.retrieve()
					.bodyToMono(UserResponse.class)
					.block();
			}

			@Override
			public Resource downloadFile(String fileId) {
				return webClient.get()
					.uri("/api/files/{id}/download", fileId)
					.retrieve()
					.bodyToMono(Resource.class)
					.block();
			}
		}

	âœ… ä½¿ç”¨æ™‚å°±è·Ÿ FeignClient ä¸€æ¨£ç°¡æ½”ï¼š
		@Autowired
		private FileApiClient fileApiClient;

		public void doSomething() {
			var user = fileApiClient.getUser("abc");
			var file = fileApiClient.downloadFile("file123");
		}

	âœ… å„ªå‹¢æ¯”è¼ƒ
		| åŠŸèƒ½                                    | FeignClient | å°è£ WebClient                |
		| --------------------------------------- | ----------- | ----------------------------- |
		| å‹åˆ¥å®‰å…¨ã€ä»‹é¢å‘¼å«                      | âœ… æœ‰       | âœ… æœ‰ï¼ˆä½ è‡ªå·±å®šç¾© interfaceï¼‰ |
		| è‡ªå‹•åŠ  Bearer Token                     | âœ… æœ‰       | âœ… å¯åŠ  filter + oauth2 æ”¯æ´  |
		| å¯ä¸²æµä¸‹è¼‰                              | âŒ ä¸æ”¯æ´   | âœ… å®Œå…¨å¯æ”¯æ´                 |
		| å¯å®Œæ•´æ§åˆ¶ Header / Content-Disposition | âŒ é›£       | âœ… ç°¡å–®                       |
		| éŒ¯èª¤æ””æˆªèˆ‡ retry                        | âœ… ä½†æœ‰é™   | âœ… å®Œæ•´æ”¯æŒï¼ˆReactor Retryï¼‰  |
		| å¤š part file ä¸Šå‚³                       | âš  è¤‡é›œ     | âœ… WebClient æ›´å¼·             |

	ğŸ§  å»ºè­°å¯¦å‹™åšæ³•ï¼ˆè‹¥ä½ åå‘å½ˆæ€§ï¼‰
		| é …ç›®                                    | å»ºè­°                                                             |
		| --------------------------------------- | ---------------------------------------------------------------- |
		| å°æ‰€æœ‰å¾®æœå‹™éƒ½ä½¿ç”¨ WebClient            | å°è£ç‚º `ServiceApiClient` interface + `Impl`                     |
		| æä¾› baseUrl èˆ‡ token filter å…±ç”¨è¨­å®š   | ç”¨ `WebClient.Builder` + Filter å¯¦ç¾                             |
		| å»ºç«‹ä»‹é¢å°ˆæ¡ˆ                            | ä½ å¯ä»¥æŠŠ `ApiClient` interface æ”¾é€² `common-api` æ¨¡çµ„ï¼Œæ”¯æ´ mock |
