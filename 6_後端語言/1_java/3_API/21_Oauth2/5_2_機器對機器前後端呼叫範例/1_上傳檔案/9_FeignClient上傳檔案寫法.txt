ref ChatGPT

FeignClient æ˜¯æ”¯æ´æª”æ¡ˆä¸Šå‚³çš„ï¼Œä½†ä¸ç›´è¦ºï¼Œä¹Ÿä¸æ˜¯é è¨­é–‹ç®±æ”¯æ´

ğŸ¯ åŸå› è§£æï¼šç‚ºä½• Feign æ²’æŠŠ multipart åšæˆé–‹ç®±åŠŸèƒ½ï¼Ÿ
	1. Feign è¨­è¨ˆå“²å­¸æ˜¯â€œæœ€å°æŠ½è±¡â€
		å®ƒåªæ˜¯æŠŠä»‹é¢ method è½‰ç‚º HTTP å‘¼å«
		ä¸¦ä¸åƒ WebClient ä¸€æ¨£æä¾›ä¸²æµæ§åˆ¶ã€ä½éš multipart API

	2. Spring Cloud å° multipart çš„æ”¯æ´å…¶å¯¦æ˜¯é€é Spring MVC Encoder
		è‹¥ä½ æ²’é¡å¤–è¨­å®š Encoderï¼ŒFeignClient ä¸çŸ¥é“æ€éº¼æŠŠæª”æ¡ˆè½‰æˆ multipart body
		æ‰€ä»¥ä½ éœ€è¦å¼•å…¥ï¼š
		<dependency>
		  <groupId>io.github.openfeign.form</groupId>
		  <artifactId>feign-form-spring</artifactId>
		</dependency>

	3. å°æª”æ¡ˆä¸Šå‚³æ”¯æ´çš„è¡Œç‚ºå–æ±ºæ–¼ Encoder è¨­å®šæ˜¯å¦æ”¯æ´ multipart/form-data

âœ… æ­£ç¢ºåšæ³•ï¼šFeign + æª”æ¡ˆä¸Šå‚³æ”¯æ´æ­¥é©Ÿ
	ğŸ“¦ 1. å¼•å…¥ä¾è³´ï¼š
		<dependency>
		  <groupId>io.github.openfeign.form</groupId>
		  <artifactId>feign-form-spring</artifactId>
		</dependency>

	âš™ï¸ 2. è‡ªè¨‚ Encoder è¨»å†Šçµ¦ FeignClientï¼š
		@Configuration
		public class FeignMultipartSupportConfig {

			@Bean
			public Encoder feignFormEncoder() {
				return new SpringFormEncoder();
			}
		}

	ğŸ–‹ï¸ 3. FeignClient å®£å‘Šæª”æ¡ˆä¸Šå‚³æ–¹æ³•ï¼š
		@FeignClient(name = "file-service", url = "${file.service.url}",
					 configuration = FeignMultipartSupportConfig.class)
		public interface FileUploadClient {

			@PostMapping(value = "/upload", consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
			String uploadFile(@RequestPart("file") MultipartFile file);
		}


âš ï¸ é™åˆ¶èˆ‡æ³¨æ„ï¼š
	| å•é¡Œ                                   | èªªæ˜                                                         |
	| -------------------------------------- | ------------------------------------------------------------ |
	| âŒ ä¸²æµç„¡æ³•è™•ç†                        | Feign ä¸æ”¯æ´å¤§æª”æ¡ˆ streamingï¼Œåªèƒ½ memory æ¨¡å¼               |
	| âŒ ç„¡æ³•ç”¨ `InputStream` å‚³             | å¿…é ˆæ˜¯ `MultipartFile` æˆ– `File` å‹åˆ¥                        |
	| âŒ ä¸æ”¯æ´å‹•æ…‹ Content-Disposition è¨­å®š | å½ˆæ€§å·®ï¼ŒWebClient æ›´é©åˆè™•ç†ç´°ç¯€                             |
	| âŒ å›å‚³å‹åˆ¥è¦æ³¨æ„                      | æœ‰äº›æƒ…æ³ç„¡æ³•æ­£ç¢ºè§£ JSON error responseï¼ˆéœ€é¡å¤–è™•ç† decoderï¼‰ |
