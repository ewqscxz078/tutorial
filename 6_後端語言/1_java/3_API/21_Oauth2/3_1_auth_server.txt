âœ… æ­¥é©Ÿä¸€ï¼šCI/CD æ±ºå®š client_id / client_secret
	åœ¨ CI/CD pipeline ä¸­ï¼Œç‚ºæ¯å€‹ client é å…ˆç”¢å‡º client_id / client_secretï¼š

		* éš¨æ©Ÿç”¢ç”Ÿ
		* æˆ–ç”± Git repository/éƒ¨ç½²è…³æœ¬è¨­å®š
		* å­˜å…¥ï¼šVault / AWS Secrets Manager / GitHub Actions Secret / K8s Secret / Config Server / CI CD variables

âœ… æ­¥é©ŸäºŒï¼šAuth Server å•Ÿå‹•æ™‚å¾ Secret æ³¨å…¥ï¼Œè¨»å†Š RegisteredClient
	Spring Boot å•Ÿå‹•æ™‚è®€å–ä¾†è‡ª secrets çš„è³‡è¨Šï¼Œåˆå§‹åŒ–è¨»å†Šï¼š
		myauth:
		  clients:
			- clientId: service-a
			  clientSecret: ${CLIENT_A_SECRET}
			  scopes: [read]
			- clientId: service-b
			  clientSecret: ${CLIENT_B_SECRET}
			  scopes: [read, write]

	ç„¶å¾Œè½‰ç‚º RegisteredClient
		@ConfigurationProperties(prefix = "myauth")
		public class MyAuthProperties {
			private List<ClientProperties> clients;
			// getter/setter
		}

		public class ClientProperties {
			private String clientId;
			private String clientSecret;
			private List<String> scopes;
			// getter/setter
		}

		@Bean
		public CommandLineRunner registerClients(MyAuthProperties props,
												 RegisteredClientRepository repo,
												 PasswordEncoder encoder) {
			return args -> {
				for (ClientProperties client : props.getClients()) {
					if (repo.findByClientId(client.getClientId()) == null) {
						RegisteredClient rc = RegisteredClient.withId(UUID.randomUUID().toString())
							.clientId(client.getClientId())
							.clientSecret(encoder.encode(client.getClientSecret()))
							.authorizationGrantType(AuthorizationGrantType.CLIENT_CREDENTIALS)
							.scopes(s -> s.addAll(client.getScopes()))
							.build();
						repo.save(rc);
					}
				}
			};
		}

âœ… æ­¥é©Ÿä¸‰ï¼šCI/CD å°‡ç›¸åŒ secret æ³¨å…¥å°æ‡‰ service
	æ¯å€‹ resource server è¢«éƒ¨ç½²æ™‚ï¼ŒCI/CD å°‡è©²æœå‹™çš„ client_id / client_secret ä¹Ÿæ³¨å…¥é€²å»
		ä¾‹å¦‚ Kubernetes çš„ secret mount
			env:
			  - name: CLIENT_ID
				valueFrom:
				  secretKeyRef:
					name: service-a-oauth
					key: client_id
			  - name: CLIENT_SECRET
				valueFrom:
				  secretKeyRef:
					name: service-a-oauth
					key: client_secret

	æˆ– build æ™‚å¯«å…¥ application.yml
		spring:
		  security:
			oauth2:
			  client:
				registration:
				  myclient:
					client-id: ${CLIENT_ID}
					client-secret: ${CLIENT_SECRET}
âœ… ç¸½çµæµç¨‹
	CI/CD
	  â”œâ”€â”€ æ±ºå®š client_id / secret
	  â”œâ”€â”€ è¨­å®šçµ¦ Auth Server å•Ÿå‹•ç’°å¢ƒè®Šæ•¸
	  â”œâ”€â”€ è¨»å†Šæˆ RegisteredClientï¼ˆSpring Boot å•Ÿå‹•æ™‚ï¼‰
	  â””â”€â”€ æ³¨å…¥åˆ°å°æ‡‰æœå‹™ï¼ˆVault/K8s/env/application.ymlï¼‰

	çµæœï¼š
	  Auth Server æœ‰è³‡æ–™
	  Client ä¹Ÿæœ‰ secret å¯ç”¨ä¾†æ‹¿ token

CI/CD pipeline âœ ç§˜å¯†ç®¡ç†æœå‹™ï¼ˆVault ç­‰ï¼‰ âœ Spring Boot å•Ÿå‹•æ™‚è®€å…¥ âœ åˆå§‹åŒ–å„²å­˜åˆ° JDBC
	ä¹Ÿå°±æ˜¯èªªï¼Œclient_id / client_secret æœ€åˆçš„ä¾†æºæ˜¯ CI/CDï¼ˆæˆ– IaCï¼‰ï¼Œä¸æ˜¯ JDBC æœ¬èº«ï¼ŒJDBC åªæ˜¯ä½œç‚º RegisteredClientRepository çš„å„²å­˜è¼‰é«”è€Œå·²

Q:ç‚ºä»€éº¼ RegisteredClient é‚„æ˜¯è¦å­˜é€² JDBCï¼Ÿ
	A: Authorization Server éœ€è¦çŸ¥é“ã€Œå“ªäº› client æ˜¯åˆæ³•çš„ã€
		curl -u my-client:abc123 https://auth-server/oauth2/token
			Auth Server æœƒå» RegisteredClientRepositoryï¼ˆé€šå¸¸æ˜¯ JDBCï¼‰æŸ¥è©¢æ˜¯å¦æœ‰é€™å€‹ clientï¼š

			å­˜åœ¨ â†’ é©—è­‰ client_secret æ˜¯å¦æ­£ç¢º

			ä¸å­˜åœ¨ â†’ å› 401 Unauthorized

			Auth Server æ˜¯ã€Œå”¯ä¸€çš„çœŸå¯¦ä¾æ“šã€ï¼ŒCI/CD åªæ˜¯å¹«å¿™æº–å‚™è€Œå·²

	A: JDBC æ˜¯ã€Œæˆæ¬Šåå–®ã€çš„è³‡æ–™åº«ï¼ŒCI/CD æ˜¯ã€Œç§˜å¯†æ³¨å…¥è€…ã€

		âœ… JDBC æ˜¯ã€Œæˆæ¬Šåå–®ã€çš„è³‡æ–™åº«ï¼ŒCI/CD æ˜¯ã€Œç§˜å¯†æ³¨å…¥è€…ã€
			è·è²¬				èªªæ˜
			CI/CD / Vault		ç”¢å‡º & åˆ†ç™¼ client_id / client_secret çµ¦ client æœå‹™
			JDBC (Auth Server)	å„²å­˜å“ªäº› client æ˜¯åˆæ³•è¨»å†Šã€å…è¨±ä»€éº¼ grant typeã€scopeã€redirect uri
			Auth Server			æ ¹æ“š JDBC ä¸­çš„è³‡æ–™ä¾†é©—è­‰æ˜¯å¦å…è¨±é€™å€‹ client æ‹¿ token

	é¡æ¯”è§£é‡‹
		CI/CD = é‘°åŒ™å·¥å» ï¼Œè² è²¬åšå‡ºé‘°åŒ™ï¼ˆclient_id / secretï¼‰ä¸¦åˆ†ç™¼çµ¦å°æ‡‰ client
		JDBC = é–€é–æ¸…å–®ï¼Œè² è²¬åˆ—å‡ºå“ªäº›é‘°åŒ™æ˜¯åˆæ³•çš„ï¼Œå¯ä»¥æ‰“é–‹å“ªä¸€æ‰‡é–€ï¼ˆscope / redirect URI / grant typeï¼‰

		ä½ éœ€è¦å…©è€…æ­é…ï¼Œæ‰æ˜¯ä¸€å€‹å®‰å…¨è€Œå¯ç¶­è­·çš„ OAuth2 æ¶æ§‹ã€‚
âœ… æœ€ä½³å¯¦å‹™ç¸½çµ
	1.CI/CD æˆ– Vaultï¼šç”¢å‡º + ç®¡ç† + æ³¨å…¥ client_id / secret

	2.Spring Authorization Server å•Ÿå‹•æ™‚ï¼šè®€å–é€™äº›è³‡è¨Šè¨»å†Šåˆ° JDBC

	3.Client App å•Ÿå‹•æ™‚ï¼šé€é Vaultã€ç’°å¢ƒè®Šæ•¸ã€k8s Secret å–å¾—è‡ªå·±çš„æ†‘è­‰ä½¿ç”¨

	4.JDBC è³‡æ–™åº«ï¼šå”¯ä¸€çš„æˆæ¬Šä¾†æº + æ”¯æ´æŸ¥è©¢èˆ‡è®Šæ›´æ§åˆ¶


Q: æˆ‘ä¸èƒ½ä¸€ç›´å¾ MyAuthProperties è¨»å†Šåˆ° InMemory ?
	é€™ç¢ºå¯¦å¯ä»¥é‹ä½œï¼Œåªè¦åœ¨æ¯æ¬¡ Auth Server å•Ÿå‹•æ™‚ï¼ŒæŠŠ client é€é MyAuthProperties è¨»å†Šåˆ° InMemoryRegisteredClientRepositoryï¼Œä¾‹å¦‚ï¼š
		@Bean
		public RegisteredClientRepository registeredClientRepository(MyAuthProperties props, PasswordEncoder encoder) {
			List<RegisteredClient> clients = props.getClients().stream()
				.map(client -> RegisteredClient.withId(UUID.randomUUID().toString())
					.clientId(client.getClientId())
					.clientSecret(encoder.encode(client.getClientSecret()))
					.authorizationGrantType(AuthorizationGrantType.CLIENT_CREDENTIALS)
					.scopes(scopes -> scopes.addAll(client.getScopes()))
					.build()
				).toList();

			return new InMemoryRegisteredClientRepository(clients);
		}

A: ä½†é€™ç¨®ã€ŒInMemory æ¨¡å¼ã€æœ‰å¹¾å€‹æ˜ç¢ºé™åˆ¶ï¼š
	é™åˆ¶											èªªæ˜
	ç„¡æ³•å‹•æ…‹æ–°å¢/ä¿®æ”¹/æ’¤éŠ· client					è‹¥ä½ è¦æ–°å¢ä¸€å€‹ clientï¼Œè¦é‡æ–°éƒ¨ç½² Auth Server
	ç„¡æ³•èˆ‡ç®¡ç†å¾Œå°æ•´åˆ								ç®¡ç†è€…ä¸èƒ½é€é UI æ“ä½œæˆ–è³‡æ–™åº«ç›´æ¥ä¿®æ”¹æˆæ¬Šè³‡æ–™
	æ‰€æœ‰ secret å¿…é ˆç¡¬å¡åˆ° config / vault / env		secret lifecycle å…¨éƒ¨é  CI/CD æ§åˆ¶ï¼Œç¼ºä¹å¯è¦‹æ€§èˆ‡å¯å¯©æŸ¥æ€§
	ä¸åˆ©æ–¼æ©«å‘æ“´å±• Auth Server å¯¦ä¾‹					å¤šå€‹ Auth Server ç¯€é»æ™‚ï¼ŒInMemory å…§å®¹ç„¡æ³•å…±äº«


é è¨­è¡Œç‚ºï¼ˆSpring Authorization Server å…§å»ºï¼‰
	ç•¶ä½ æ²’æœ‰è‡ªè¨‚ä»»ä½•é‡‘é‘°æä¾›å™¨æ™‚ï¼ŒSpring Authorization Server æœƒï¼š
		1.åœ¨å•Ÿå‹•æ™‚è‡ªå‹•å‘¼å«å…§å»ºçš„ JwkSource<SecurityContext>
		2.ä½¿ç”¨ RSA ç”Ÿæˆä¸€å° 2048-bit é‡‘é‘°å°ï¼ˆKeyPairï¼‰
		3.åŒ…è£æˆ JWKSet æš´éœ²åœ¨ /oauth2/jwks endpoint
		4.ä½¿ç”¨ç§é‘°ç°½ç™¼ JWTï¼ˆRS256ï¼‰ï¼ŒResource Server å‰‡å¾ JWKS å–å¾—å…¬é‘°é©—è­‰

	å¯¦éš›é©—è­‰
		GET http://localhost:9000/oauth2/jwks
			{
			  "keys": [
				{
				  "kty": "RSA",
				  "e": "AQAB",
				  "n": "...",
				  "alg": "RS256",
				  "use": "sig",
				  "kid": "123abc..."
				}
			  ]
			}
	é€™å°±æ˜¯ Auth Server å…¬é–‹çš„ å…¬é‘°ï¼ˆJWKï¼‰ï¼ŒResource Server æœƒå¾é€™è£¡æŠ“ä¸‹ä¾†é©—ç°½ã€‚

	æ³¨æ„ï¼šé è¨­é‡‘é‘°æ˜¯æ¯æ¬¡å•Ÿå‹•éƒ½é‡æ–°ç”Ÿæˆ
		âœ… é©åˆé–‹ç™¼ã€æœ¬åœ°æ¸¬è©¦
		âŒ ä¸é©åˆæ­£å¼ç’°å¢ƒï¼ˆå› ç‚ºæ¯æ¬¡éƒ¨ç½²é‡‘é‘°æœƒè®Šï¼ŒèˆŠ JWT ç„¡æ³•é©—è­‰ï¼‰

	æ–¹å¼ä¸€ï¼šè‡ªå·±æä¾› RSA KeyPair
		@Bean
		public JWKSource<SecurityContext> jwkSource() {
			KeyPair keyPair = loadOrGenerateKeyPair();
			RSAKey rsaKey = new RSAKey.Builder((RSAPublicKey) keyPair.getPublic())
				.privateKey((RSAPrivateKey) keyPair.getPrivate())
				.keyID(UUID.randomUUID().toString())
				.build();
			return new ImmutableJWKSet<>(new JWKSet(rsaKey));
		}
		* KeyPair å¯ä»¥å¾é‡‘é‘°æª”ï¼ˆPEMï¼‰ã€keystoreã€Vault è¼‰å…¥

		* å¯é…åˆ CI/CD æˆ– Kubernetes secret ç®¡ç†é‡‘é‘°è¼ªæ›¿

	æ–¹å¼äºŒï¼šè¼‰å…¥å¤–éƒ¨é‡‘é‘°ï¼ˆå¦‚ JKS æˆ– PEMï¼‰
		Spring Authorization Server æ²’æœ‰ç›´æ¥æ”¯æ´è‡ªå‹•è¼‰å…¥ PEMï¼Œä½†ä½ å¯ä»¥ç”¨ Java æ–¹å¼è®€å…¥ï¼Œå†è½‰æˆ RSAKey

Q:å¯ä»¥åœ¨æ¯æ¬¡ä½ˆç½²æ™‚ï¼Œæ›´æ› auth server çš„é‡‘é‘°å°å—?
	æ½›åœ¨é¢¨éšªï¼ˆè‹¥æ¯æ¬¡éƒ¨ç½²éƒ½æ›é‡‘é‘°å°ï¼‰
	| å•é¡Œ                                 | èªªæ˜                                                        |
	| ------------------------------------ | ----------------------------------------------------------- |
	| âŒ èˆŠ JWT ç„¡æ³•é©—è­‰                   | Resource Server é‚„æ”¶åˆ°èˆŠ tokenï¼Œä½†å·²ç„¡å°æ‡‰çš„å…¬é‘°å¯é©—è­‰      |
	| âŒ å¤š Resource Server åŒæ­¥å¤±æ•—       | é‡‘é‘°è‹¥æœªçµ±ä¸€å…±ç”¨ï¼Œéƒ¨ç½²å¤šæœå‹™æœƒé€ æˆã€ŒA å¯é©—è­‰ï¼ŒB é©—è­‰å¤±æ•—ã€  |
	| âŒ åˆ†æ•£å¼æ¶æ§‹æœƒç™¼ç”Ÿ JWT é©—ç°½ä¸ä¸€è‡´   | åœ¨è² è¼‰å¹³è¡¡ï¼ˆå¤šå¯¦ä¾‹ï¼‰æ¶æ§‹ä¸‹ï¼Œtoken å¯èƒ½ç„¡æ³•è¢«æŸäº›ç¯€é»é©—è­‰    |

	æ­£ç¢ºä½œæ³•ï¼šé‡‘é‘°å›ºå®š + æœ‰è¨ˆç•«åœ°è¼ªæ›¿
		åšæ³•ä¸€ï¼šé‡‘é‘° å›ºå®šæ›è¼‰ï¼ˆä¸è®Šï¼‰
			æœ€ç°¡å–®ä¹Ÿæœ€ç©©å®šçš„åšæ³•ï¼š
				* ä½¿ç”¨å›ºå®šçš„ RSA é‡‘é‘°å°ï¼ˆPEMã€JKSã€Vault ç­‰ï¼‰
				* æ¯æ¬¡éƒ¨ç½²éƒ½è¼‰å…¥åŒä¸€ä»½é‡‘é‘°
				* JWT æ°¸é ç”¨é€™çµ„é‡‘é‘°ç°½ç™¼

			ğŸ“Œ é©ç”¨ï¼šå–®ç’°å¢ƒ / å…§éƒ¨ç³»çµ± / æœ‰ CI/CD secret ç®¡ç†

		 åšæ³•äºŒï¼šæ”¯æ´ Key Rotationï¼ˆé‡‘é‘°è¼ªæ›¿ï¼‰
			é€²éšå¯¦ä½œï¼š
			  1.æä¾›å¤šæŠŠé‡‘é‘°åœ¨ /oauth2/jwks ä¸­ï¼ˆä¾‹å¦‚ï¼šç›®å‰é‡‘é‘° + éæ¸¡æœŸé‡‘é‘°ï¼‰
			  2.æ¯æŠŠ JWK æœ‰å°æ‡‰çš„ kidï¼ˆkey IDï¼‰ï¼ŒJWT ä¸­æœƒå¸¶ä¸Š
			  3.Resource Server ä¾æ“š kid é¸æ“‡å°æ‡‰å…¬é‘°é©—ç°½(é€™éƒ¨åˆ†åº•å±¤å·²è‡ªå‹•è™•ç†)
			  4.è¼ªæ›¿å¾Œé€æ­¥å°‡èˆŠé‡‘é‘°æ’¤é™¤

				// src/main/java/com/example/auth/config/JwkRotationConfig.java
				package com.example.auth.config;

				import com.nimbusds.jose.jwk.JWK;
				import com.nimbusds.jose.jwk.JWKSet;
				import com.nimbusds.jose.jwk.RSAKey;
				import org.springframework.context.annotation.Bean;
				import org.springframework.context.annotation.Configuration;
				import org.springframework.security.oauth2.server.authorization.config.annotation.web.configuration.OAuth2AuthorizationServerConfiguration;
				import org.springframework.security.oauth2.server.authorization.settings.AuthorizationServerSettings;
				import com.nimbusds.jose.jwk.source.ImmutableJWKSet;
				import com.nimbusds.jose.jwk.source.JWKSource;
				import com.nimbusds.jose.proc.SecurityContext;

				import java.security.KeyPair;
				import java.security.KeyPairGenerator;
				import java.util.List;
				import java.util.UUID;

				@Configuration
				public class JwkRotationConfig {

					@Bean
					public JWKSource<SecurityContext> jwkSource() throws Exception {
						// ğŸ”‘ ç›®å‰é‡‘é‘°
						RSAKey currentKey = generateRsaJwk("current-key-id");

						// ğŸ”‘ èˆŠé‡‘é‘°ï¼ˆé‚„åœ¨æœ‰æ•ˆæœŸï¼‰
						RSAKey previousKey = generateRsaJwk("previous-key-id");

						// ğŸ§© å°‡å¤šå€‹ JWK åŒ…è£æˆ JWKSet
						JWKSet jwkSet = new JWKSet(List.of(currentKey, previousKey));
						return new ImmutableJWKSet<>(jwkSet);
					}

					// éš¨æ©Ÿç”Ÿæˆç¯„ä¾‹
					private RSAKey generateRsaJwk(String keyId) throws Exception {
						KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("RSA");
						keyPairGenerator.initialize(2048);
						KeyPair keyPair = keyPairGenerator.generateKeyPair();

						return new RSAKey.Builder((java.security.interfaces.RSAPublicKey) keyPair.getPublic())
							.privateKey((java.security.interfaces.RSAPrivateKey) keyPair.getPrivate())
							.keyID(keyId)
							.build();
					}

					@Bean
					public AuthorizationServerSettings authorizationServerSettings() {
						return AuthorizationServerSettings.builder()
							.issuer("http://localhost:9000")
							.build();
					}
				}

				// å¾ å¤–éƒ¨æª”æ¡ˆ pem å–å¾—é‡‘é‘°å°
				// src/main/java/com/example/auth/config/JwkRotationConfig.java
				package com.example.auth.config;

				import com.nimbusds.jose.jwk.JWK;
				import com.nimbusds.jose.jwk.JWKSet;
				import com.nimbusds.jose.jwk.RSAKey;
				import com.nimbusds.jose.jwk.source.ImmutableJWKSet;
				import com.nimbusds.jose.jwk.source.JWKSource;
				import com.nimbusds.jose.proc.SecurityContext;
				import org.springframework.context.annotation.Bean;
				import org.springframework.context.annotation.Configuration;
				import org.springframework.security.oauth2.server.authorization.settings.AuthorizationServerSettings;

				import java.io.FileReader;
				import java.io.IOException;
				import java.nio.file.Paths;
				import java.security.interfaces.RSAPrivateKey;
				import java.security.interfaces.RSAPublicKey;
				import java.security.KeyFactory;
				import java.security.spec.PKCS8EncodedKeySpec;
				import java.security.spec.X509EncodedKeySpec;
				import java.security.KeyPair;
				import java.security.spec.InvalidKeySpecException;
				import java.util.Base64;
				import java.util.List;

				@Configuration
				public class JwkRotationConfig {

					@Bean
					public JWKSource<SecurityContext> jwkSource() throws Exception {
						// ğŸ” å¾ PEM è¼‰å…¥å…©çµ„é‡‘é‘°
						RSAKey currentKey = loadRsaKeyFromPem("keys/current-key", "current-key-id");

						File oldKeyFile = new File("src/main/resources/keys/previous-key.pem");
						if (oldKeyFile.exists()) {
							RSAKey previousKey = loadRsaKeyFromPem("keys/previous-key", "previous-key-id");
							keys.add(loadRsaKeyFromPem(...));
						}


						JWKSet jwkSet = new JWKSet(List.of(currentKey, previousKey));
						return new ImmutableJWKSet<>(jwkSet);
					}

					private RSAKey loadRsaKeyFromPem(String baseFileName, String keyId) throws Exception {
						RSAPrivateKey privateKey = loadPrivateKeyFromPem(baseFileName + ".pem");
						RSAPublicKey publicKey = loadPublicKeyFromPem(baseFileName + ".pub.pem");

						return new RSAKey.Builder(publicKey)
							.privateKey(privateKey)
							.keyID(keyId)
							.build();
					}

					private RSAPrivateKey loadPrivateKeyFromPem(String filepath) throws IOException, InvalidKeySpecException {
						String pem = readPem(filepath);
						String keyContent = pem.replace("-----BEGIN PRIVATE KEY-----", "")
							.replace("-----END PRIVATE KEY-----", "")
							.replaceAll("\\s", "");

						byte[] keyBytes = Base64.getDecoder().decode(keyContent);
						PKCS8EncodedKeySpec spec = new PKCS8EncodedKeySpec(keyBytes);
						KeyFactory kf = KeyFactory.getInstance("RSA");
						return (RSAPrivateKey) kf.generatePrivate(spec);
					}

					private RSAPublicKey loadPublicKeyFromPem(String filepath) throws IOException, InvalidKeySpecException {
						String pem = readPem(filepath);
						String keyContent = pem.replace("-----BEGIN PUBLIC KEY-----", "")
							.replace("-----END PUBLIC KEY-----", "")
							.replaceAll("\\s", "");

						byte[] keyBytes = Base64.getDecoder().decode(keyContent);
						X509EncodedKeySpec spec = new X509EncodedKeySpec(keyBytes);
						KeyFactory kf = KeyFactory.getInstance("RSA");
						return (RSAPublicKey) kf.generatePublic(spec);
					}

					private String readPem(String path) throws IOException {
						return new String(java.nio.file.Files.readAllBytes(Paths.get("src/main/resources/" + path)));
					}

					@Bean
					public AuthorizationServerSettings authorizationServerSettings() {
						return AuthorizationServerSettings.builder()
							.issuer("http://localhost:9000")
							.build();
					}
				}
				
				AuthorizationServerSettings.builder().issuer
					ğŸ” å®ƒçš„ä½œç”¨æ˜¯ä»€éº¼ï¼Ÿ
						ğŸ‘‰ è¨­å®š Authorization Server çš„ç™¼è¡Œè€…è­˜åˆ¥ï¼ˆissuerï¼‰ï¼Œé€™å€‹å€¼æœƒå½±éŸ¿ï¼š
							1.JWT token ä¸­çš„ iss æ¬„ä½
							2.Resource Server é©—è­‰ JWT æ™‚æœƒå°æ‡‰çš„ç™¼è¡Œè€…ç¶²å€
							3..well-known/openid-configuration çš„å°å¤–æš´éœ²å…§å®¹
					
					ğŸ§© ç‚ºä»€éº¼é€™å¾ˆé‡è¦ï¼Ÿ
						1.JWT é©—è­‰ç›¸ç¬¦æ€§ä¾è³´ issuer
							ç•¶ Resource Server é©—è­‰ JWT æ™‚ï¼Œæœƒæ ¹æ“šè¨­å®šçš„ issuer-uri å»æ¯”å° JWT çš„ iss æ¬„ä½ï¼š
								{
								  "iss": "http://localhost:9000",
								  ...
								}
							å¦‚æœ Resource Server è¨­çš„æ˜¯ï¼š
								spring:
								  security:
									oauth2:
									  resourceserver:
										jwt:
										  issuer-uri: http://localhost:9000
								âœ… é‚£éº¼é€™å…©å€‹æœƒç›¸ç¬¦ â†’ é©—è­‰æˆåŠŸ
								âŒ è‹¥ä¸ç›¸ç¬¦ï¼ˆå¦‚ä¸€é‚Šæ˜¯ http://auth.example.comï¼‰â†’ é©—è­‰æœƒå¤±æ•—
						2.well-known/openid-configuration çš„ metadata ä¹Ÿä¾è³´å®ƒ
							{
							  "issuer": "http://localhost:9000",
							  "jwks_uri": "http://localhost:9000/oauth2/jwks",
							  ...
							}
							é€™æ˜¯ Resource Server æƒæ JWKS æ‰€ä¾è³´çš„å…¥å£é» â†’ è‹¥æœªè¨­å®šï¼Œå¯èƒ½æœƒå°ä¸ä¸Šã€‚

				é æœŸçš„é‡‘é‘°æª”æ¡ˆæ”¾ç½®ä½ç½®
					src/main/resources/keys/
					â”œâ”€â”€ current-key.pem       â† ç§é‘°ï¼ˆPKCS#8 æ ¼å¼ï¼‰
					â”œâ”€â”€ current-key.pub.pem   â† å…¬é‘°ï¼ˆX.509 æ ¼å¼ï¼‰
					â”œâ”€â”€ previous-key.pem
					â””â”€â”€ previous-key.pub.pem


				ğŸ” å¦‚ä½•é€²è¡Œé‡‘é‘°è¼ªæ›¿ï¼ˆå»ºè­°æµç¨‹ï¼‰
					1.åŠ å…¥æ–°çš„é‡‘é‘°ï¼Œè®Šæˆï¼š[newKey, currentKey]
					2.è®“ Auth Server ç”¨ newKey ç™¼æ–°çš„ JWT
					3.ç­‰æ‰€æœ‰èˆŠ JWT éæœŸå¾Œï¼ˆä¾‹å¦‚é 1~2 å°æ™‚ï¼‰
					4.ç§»é™¤èˆŠé‡‘é‘°ï¼Œåªä¿ç•™ newKey
					ä½ å¯ä»¥å°‡ JWK ç®¡ç†æŠ½æˆé…ç½®æª”è¼‰å…¥ã€å¾æª”æ¡ˆ/DB/Vault å–é‡‘é‘°ï¼Œåšåˆ°è‡ªå‹•åŒ– key rotation

	ã€ŒçœŸæ­£çš„åˆ†æ•£å¼ç³»çµ±ï¼ˆæˆ–é«˜å¯ç”¨ç³»çµ±ï¼‰ä¸æœƒæ‰€æœ‰æœå‹™ä¸€èµ·ä¸Šä¸‹ç·šã€
		* å¯¦å‹™ä¸Šå¯èƒ½åªæœ‰ Auth Server éƒ¨ç½²æ–°ç‰ˆã€æˆ–æŸå€‹å¾®æœå‹™åšç†±éƒ¨ç½²
		* å‰ç«¯æˆ– cron job å¯èƒ½é‚„æŒæœ‰èˆŠ token
		* å¦‚æœé‡‘é‘°è®Šäº†ä½† Resource Server é‚„æ²’ reloadï¼Œå°±æœƒé©—è­‰å¤±æ•—

é è¨­ jwt
	| å•é¡Œ                           | å›ç­”                          |
	| ------------------------------ | ----------------------------- |
	| Spring Boot JWT é è¨­æœ‰æ•ˆå¤šä¹…ï¼Ÿ | âœ… 5 åˆ†é˜ï¼ˆaccess tokenï¼‰     |
	| å¯ä»¥ä¿®æ”¹å—ï¼Ÿ                   | âœ… å¯ä»¥ï¼Œé€é `tokenSettings` |
	| refresh token é è¨­å¤šä¹…ï¼Ÿ       | âœ… 60 åˆ†é˜ï¼Œå¯è‡ªè¨‚            |



Q: è‹¥ä¸æ˜¯ä½¿ç”¨ oauth2 æ¶æ§‹ï¼Œæ¯å€‹æœå‹™è‡ªå·±ç”¢ç”Ÿjwt é€åˆ°å¾Œç«¯æœå‹™æ™‚ï¼Œ å‰‡ jwt ç§é‘°æœƒæ•£è½åœ¨å„å€‹æœå‹™ä¸Šï¼Œä¸åˆ©æ–¼ç®¡ç†?
	ã€Œå¦‚æœä¸æ˜¯ä½¿ç”¨ OAuth2ï¼Œè€Œæ˜¯è®“æ¯å€‹æœå‹™å„è‡ªç”¢ç”Ÿ JWTï¼ˆè‡ªç°½ï¼‰ï¼Œé‚£éº¼ç§é‘°å°±æœƒæ•£è½åœ¨å„å€‹æœå‹™ä¹‹ä¸­ï¼Œé€ æˆï¼š
		âŒ é›£ä»¥ç®¡ç†ã€âŒ å®‰å…¨é¢¨éšªé«˜ã€âŒ è¼ªæ›¿å›°é›£ã€âŒ é©—è­‰ç„¡ä¸€è‡´æ€§ã€‚ã€

	å¦‚æœæ¯å€‹æœå‹™è‡ªå·±ç°½ç™¼ JWTï¼Œæœƒæœ‰é€™äº›å•é¡Œ
		| å•é¡Œé¡å‹          | æè¿°                                                                  |
		| ----------------- | --------------------------------------------------------------------- |
		| ğŸ” ç§é‘°æ•£è½       | æ¯å€‹æœå‹™éƒ½è¦æœ‰è‡ªå·±çš„ç§é‘° â†’ å¯†é‘°æ•¸é‡å¤šï¼Œç®¡ç†æˆæœ¬é«˜                     |
		| ğŸ§¾ é©—è­‰ä¸ä¸€è‡´     | Resource Server å¿…é ˆçŸ¥é“ã€Œå“ªå€‹æœå‹™ç™¼çš„ token è¦ç”¨å“ªæŠŠå…¬é‘°ä¾†é©—è­‰ã€     |
		| ğŸ›‘ ç„¡æ³•æ’¤éŠ· token | æ²’æœ‰é›†ä¸­ç™¼è¡Œè€…ï¼Œä¸çŸ¥é“èª°ç™¼å‡ºä¾†çš„ token å¯ä¿¡ã€è¦ä¸è¦æ’¤æ‰               |
		| ğŸ”„ è¼ªæ›¿æ¥µé›£       | å¤šæœå‹™éƒ½æŒæœ‰é‡‘é‘°æ™‚ï¼Œè¼ªæ›¿æ™‚å¿…é ˆåŒæ­¥æ›´æ–° N å€‹æœå‹™ï¼Œå¾ˆå®¹æ˜“æ¼æ‰æˆ–ç™¼ç”Ÿä¸­æ–· |
		| â“ ç„¡ç¨½å¯æŸ¥       | ç„¡ä¸­å¿ƒæ§ç®¡ï¼Œaudit logã€scope é™åˆ¶ã€ç”¨é€”å€éš”éƒ½ä¸æ¸…æ¥š                   |

	ä½¿ç”¨ OAuth2 + Authorization Server çš„å„ªé»
		| å„ªé»                    | æè¿°                                                              |
		| ----------------------- | ----------------------------------------------------------------- |
		| âœ… é‡‘é‘°é›†ä¸­             | JWT åªç”± Auth Server ç°½ç™¼ â†’ ç§é‘°é›†ä¸­æ§ç®¡ã€å®‰å…¨æ€§æ›´é«˜              |
		| âœ… å…¬é‘°æ¨™æº–ç™¼ä½ˆï¼ˆJWKSï¼‰ | æ‰€æœ‰ Resource Server çµ±ä¸€å¾ `/.well-known/jwks.json` æŠ“å…¬é‘°é©—è­‰   |
		| âœ… Scope æ§ç®¡           | token å…§å®¹ç”± Auth Server çµ±ä¸€å®šç¾© scope / claimï¼Œæˆæ¬Šä¸€è‡´         |
		| âœ… Token è¼ªæ›¿å®¹æ˜“       | æ›é‡‘é‘°åªè¦æ›´æ–° Auth Serverï¼Œå…¶ä»– RS æœƒè‡ªå‹•æŠ“åˆ°æ–°å…¬é‘°              |
		| âœ… å¤š client æ”¯æ´       | å„å‰ç«¯æˆ– backend åªæ‹¿ tokenï¼Œ**ä¸éœ€è¦çŸ¥é“ç°½åç§˜å¯†**               |

	å°çµ
		| æ¶æ§‹æ–¹å¼                   | å®‰å…¨æ€§ | å¯ç¶­è­·æ€§  | é©ç”¨æƒ…å¢ƒ                         |
		| -------------------------- | ------ | --------- | -------------------------------- |
		| æ¯å€‹æœå‹™è‡ªå·±ç”¢ JWT         | âŒ ä½  | âŒ é›£ç¶­è­· | demoã€å–®æ©Ÿç³»çµ±ã€ä¸æ•æ„Ÿè³‡æ–™å ´æ™¯   |
		| é›†ä¸­å¼ OAuth2 Auth Server  | âœ… é«˜  | âœ… æœ€ä½³   | æ­£å¼ç’°å¢ƒã€å¤šæœå‹™ã€å¤š client æ¶æ§‹ |

Q:å³ä½¿æ¯å€‹æœå‹™è‡ªå·±ç”¢ç”Ÿjwt é€åˆ°å¾Œç«¯æœå‹™ ç›¸é—œçš„è™•ç†æŠ½å‡ºé€šç”¨çš„å…ƒä»¶ï¼Œä»æœƒæœ‰ç›¸é—œç®¡ç†ä¸Šçš„å›°æ“¾?
	å³ä½¿ä½ å°‡ã€Œæ¯å€‹æœå‹™è‡ªå·±ç”¢ç”Ÿ JWTã€çš„è™•ç†é‚è¼¯æŠ½æˆå…±ç”¨å…ƒä»¶ï¼ˆlibraryï¼‰ï¼Œåœ¨å¯¦å‹™ä¸Šé‚„æ˜¯æœƒæœ‰ç®¡ç†ä¸Šçš„çµæ§‹æ€§å›°æ“¾ï¼Œä¸»è¦åŸå› æ˜¯ï¼šã€Œé‚è¼¯å…±ç”¨ â‰  å®‰å…¨æ²»ç†çµ±ä¸€ã€

	ç‚ºä»€éº¼æŠ½å…±ç”¨å…ƒä»¶é‚„æ˜¯æœƒæœ‰å•é¡Œï¼Ÿ
		| å•é¡Œé¡å‹                    | åŸå› èˆ‡èªªæ˜                                                                                   |
		| --------------------------- | -------------------------------------------------------------------------------------------- |
		| ğŸ” **ç§é‘°æ•£å¸ƒ**             | å³ä½¿å…±ç”¨ libraryï¼Œç§é‘°ä»éœ€å­˜åœ¨æ–¼æ¯å€‹ç”¢ token çš„æœå‹™ä¸­ â†’ ä¸€æ¨£ã€Œæ¯å°æ©Ÿå™¨éƒ½æœ‰å¯†é‘°ã€çš„é¢¨éšªã€‚     |
		| ğŸ›¡ **è¼ªæ›¿å›°é›£**             | è¼ªæ›¿ç§é‘°æ™‚ï¼Œè¦åŒæ™‚éƒ¨ç½² N å€‹æœå‹™ï¼ˆæ›´æ–°é‡‘é‘°ï¼‰ï¼Œå¾ˆé›£åšåˆ°ç„¡ç¸«éæ¸¡èˆ‡é¢¨éšªéš”é›¢ã€‚                    |
		| ğŸ” **ç„¡æ³•é›†ä¸­ç¨½æ ¸**         | å› ç‚ºæ¯å€‹æœå‹™éƒ½èƒ½è‡ªå·±ç”¢ tokenï¼Œç„¡æ³•çŸ¥é“ã€Œèª°ç™¼çš„ã€ç‚ºä»€éº¼ç™¼ã€ç”¨äº†å“ªäº› claimã€ã€‚                 |
		| ğŸ¯ **é©—è­‰é‚è¼¯ä¾è³´å‰ç½®æœå‹™** | æ¯å€‹ Resource Server éœ€è¦çŸ¥é“è©² token æ˜¯å“ªå€‹æœå‹™ç™¼çš„ã€å°æ‡‰å“ªå€‹ keyï¼Œç„¡æ³•å–®ä¸€ä¾†æºé©—è­‰ã€‚       |
		| ğŸš« **Revocation ä¸å¯è¡Œ**    | è‹¥æœ‰å®‰å…¨äº‹ä»¶ï¼ˆtoken æ´©æ¼ï¼‰ï¼Œç„¡æ³•é›†ä¸­æ’¤éŠ·æˆ–è¨­ blacklistï¼Œå› ç‚ºä½ ç”šè‡³ä¸çŸ¥é“æ˜¯èª°ç™¼çš„ã€‚           |
	æ¯”å–»ç†è§£ï¼ˆå…±ç”¨ library â‰  å®‰å…¨é›†ä¸­ï¼‰
		é€™å°±åƒä½ å…¬å¸è£¡çš„æ¯ä½å·¥ç¨‹å¸«éƒ½ç”¨åŒä¸€å¥—å¯†ç¢¼ç”¢ç”Ÿå™¨ç¨‹å¼ï¼ˆlibraryï¼‰ä¾†è¨­è¨ˆè‡ªå·±çš„å¤§é–€é‘°åŒ™ï¼Œä½†æ¯äººéƒ½è‡ªå·±ç®¡ç†é‚£æŠŠç§é‘°ğŸ”ï¼š
		ğŸ” å¯†ç¢¼ç”Ÿæˆç¨‹å¼ä¸€æ¨£ï¼ˆlibraryï¼‰

		âŒ ä½†æ¯æŠŠé‘°åŒ™éƒ½è‡ªå·±ä¿ç®¡ï¼ˆç§é‘°åˆ†æ•£ï¼‰

		ğŸ” æ²’æœ‰é‘°åŒ™ä¸­å¿ƒï¼Œä¸çŸ¥é“èª°é€²å‡ºå“ªè£¡

		ğŸ”„ æ›é–æ™‚è¦é€šçŸ¥æ¯å€‹äººåŒæ­¥æ›´æ–°æ‰€æœ‰é‘°åŒ™



auth server YML æ›´å¸¸è¦‹çš„ä½œæ³•æ˜¯ï¼š
	auth:
	  clients:
		- clientId: frontend-app
		  scopes: [read_profile, order.read]
		  grantTypes: [authorization_code]


	clientSecret ç”± CI/CD æ³¨å…¥ï¼š
		auth:
		  secrets:
			frontend-app: ${FRONTEND_APP_SECRET}

	å•Ÿå‹•è¨»å†Šæ™‚åšåˆä½µï¼š
		String clientSecret = injectedSecrets.get(client.getClientId());
		RegisteredClient client = RegisteredClient.withId(...)
			.clientId(client.getClientId())
			.clientSecret(encoder.encode(clientSecret))
			...

	è‹¥ç‚º SaaS æœå‹™å¹³å°å‰‡æ‰å»ºè­° clientId ç”± CICD å‹•æ…‹ç”¢ç”Ÿï¼Œä¸ç„¶ä¸€èˆ¬çµ¦æ‡‰ç”¨ç¨‹å¼è¨­å®š


Q:client_secret æ‡‰è©²å¤šä¹…æ›´æ–°ä¸€æ¬¡?
	å»ºè­°çš„ client_secret è¼ªæ›¿ï¼ˆrotationï¼‰é »ç‡
		æœ€å°‘ 90 å¤©ä¸€æ¬¡ï¼Œç†æƒ³æ¯ 30ï½60 å¤©ä¸€æ¬¡ï¼Œæˆ–æ ¹æ“šä½ çš„çµ„ç¹”çš„è³‡è¨Šå®‰å…¨æ”¿ç­–
	ğŸ” ç‚ºä»€éº¼éœ€è¦å®šæœŸæ›´æ–° client_secretï¼Ÿ
		| åŸå›                                      | èªªæ˜                                                           |
		| ---------------------------------------- | -------------------------------------------------------------- |
		| ğŸ”“ **é¿å…é•·æ•ˆæ©Ÿæ•è³‡è¨Šå¤–æ´©é¢¨éšª**          | `client_secret` æ´©æ¼æ™‚ï¼Œè‹¥ä¸è¼ªæ›¿ï¼Œæ”»æ“Šè€…å¯æ°¸ä¹…æ› token         |
		| ğŸ“œ **ç¬¦åˆå®‰å…¨ç¨½æ ¸è¦æ±‚**                  | å¾ˆå¤šçµ„ç¹”è¦æ±‚ secretï¼ˆAPI Keyã€å¯†ç¢¼ç­‰ï¼‰éœ€å®šæœŸæ›´æ–°               |
		| ğŸ”„ **å°æ‡‰é‡‘é‘°/æ†‘è­‰è¼ªæ›¿ç­–ç•¥**             | è‹¥ä½ å·²æ¡ JWT çš„ key rotationï¼Œ`client_secret` ä¹Ÿæ‡‰é…åˆæ›´æ–°é€±æœŸ |
		| âœ… **ç¢ºä¿ CI/CD æˆ– Secret ç®¡ç†æµç¨‹å¯æ§** | å®šæœŸè¼ªæ›¿å¯ä»¥æ¸¬è©¦ã€é©—è­‰æµç¨‹çš„è‡ªå‹•åŒ–æ˜¯å¦ç©©å¥                     |

	ğŸ§© å®¢è£½åŒ–è¼ªæ›¿ç­–ç•¥å»ºè­°
		| æ‡‰ç”¨å ´æ™¯é¡å‹            | å»ºè­°è¼ªæ›¿é€±æœŸ     | å‚™è¨»                              |
		| ----------------------- | ---------------- | --------------------------------- |
		| å–®ä¸€æœå‹™ã€å…§éƒ¨ä½¿ç”¨      | æ¯ 60ï½90 å¤©     | å¯è‡ªå‹•ç™¼ tokenï¼Œé¢¨éšªè¼ƒä½          |
		| å¤šç§Ÿæˆ¶ SaaS ä½¿ç”¨        | æ¯ 30ï½60 å¤©     | å› ç§Ÿæˆ¶æ“ä½œåˆ†æ•£ï¼Œå»ºè­°å®‰å…¨åš´æ ¼      |
		| å«ç¬¬ä¸‰æ–¹æ•´åˆ / å¤–éƒ¨åˆä½œ | æ¯ 30 å¤©æˆ–æ›´é »ç¹ | secret æœ‰è¢«è¤‡è£½ã€ä»£ç†ã€è½‰ç™¼é¢¨éšª   |
	âœ… æŠ€è¡“é¢å¯¦ä½œå»ºè­°
		| é …ç›®                    | å»ºè­°åšæ³•                                          |
		| ----------------------- | ------------------------------------------------- |
		| secret ç®¡ç†             | ç”¨ Vaultã€K8s secretã€GitOps ç®¡ç†ï¼Œä¸å¯«æ­»ç¨‹å¼ç¢¼   |
		| è¼ªæ›¿æ–¹å¼                | æ”¯æ´é›™ clientSecret æ¨¡å¼ï¼ˆnew + oldï¼‰ â†’ æ¼¸é€²æ›¿æ›  |
		| æ›´æ–°æµç¨‹è‡ªå‹•åŒ–          | CI/CD å®šæ™‚è§¸ç™¼é‡ç½®æµç¨‹ï¼ˆex: GitLab schedule jobï¼‰ |
		| secret æ›´æ–°å¾Œçš„åŒæ­¥æ©Ÿåˆ¶ | è®“ consumerï¼ˆclientï¼‰èƒ½åŒæ­¥æ”¶åˆ°æ–° secret          |

	ğŸ” é›™ client_secret è¼ªæ›¿æ¨¡å¼ï¼ˆé€²éšåšæ³•ï¼‰
		ç‚ºäº†é¿å…è¼ªæ›¿é€ æˆä¸­æ–·ï¼Œå¯æ”¯æ´ï¼š
			clientId: service-a
			clientSecrets:
			  - active: ${CLIENT_SECRET_V2}     # æ–°çš„
			  - fallback: ${CLIENT_SECRET_V1}   # èˆŠçš„é‚„ä¿ç•™å¹¾å¤©
	âœ… å°çµ
		| å•é¡Œ                           | å›ç­”                                      |
		| ------------------------------ | ----------------------------------------- |
		| `client_secret` å»ºè­°å¤šä¹…æ›´æ–°ï¼Ÿ | âœ… æ¯ 30ï½90 å¤©ä¾é¢¨éšªç¨‹åº¦èª¿æ•´             |
		| æ˜¯å¦è¦é›™ secret æ”¯æ´æ¼¸é€²è¼ªæ›¿ï¼Ÿ | âœ… å»ºè­°æœ‰ï¼Œé¿å…éƒ¨ç½²ç©ºçª—                   |
		| å¦‚ä½•åšæœ€å¥½ï¼Ÿ                   | âœ… secret å¤–éƒ¨åŒ– + è‡ªå‹•è¼ªæ›¿ + é›™ key æ”¯æ´ |


		// src/main/java/com/example/auth/security/MultiSecretClientAuthenticationProvider.java
		package com.example.auth.security;

		import org.springframework.security.authentication.BadCredentialsException;
		import org.springframework.security.crypto.password.PasswordEncoder;
		import org.springframework.security.oauth2.core.AuthorizationGrantType;
		import org.springframework.security.oauth2.server.authorization.authentication.OAuth2ClientAuthenticationToken;
		import org.springframework.security.oauth2.server.authorization.client.RegisteredClient;
		import org.springframework.security.oauth2.server.authorization.client.RegisteredClientRepository;
		import org.springframework.security.oauth2.server.authorization.authentication.OAuth2ClientAuthenticationProvider;

		import java.util.List;
		import java.util.Map;

		public class MultiSecretClientAuthenticationProvider extends OAuth2ClientAuthenticationProvider {

			private final RegisteredClientRepository registeredClientRepository;
			private final PasswordEncoder passwordEncoder;
			private final Map<String, List<String>> fallbackSecrets; // clientId -> list of encoded fallback secrets

			public MultiSecretClientAuthenticationProvider(RegisteredClientRepository repo,
														   PasswordEncoder encoder,
														   Map<String, List<String>> fallbackSecrets) {
				super(repo);
				this.registeredClientRepository = repo;
				this.passwordEncoder = encoder;
				this.fallbackSecrets = fallbackSecrets;
			}

			@Override
			protected void validateClientSecret(OAuth2ClientAuthenticationToken authentication, RegisteredClient registeredClient) {
				String rawSecret = authentication.getClientSecret();
				String primarySecret = registeredClient.getClientSecret();

				if (passwordEncoder.matches(rawSecret, primarySecret)) {
					return; // primary secret OK
				}

				List<String> fallbacks = fallbackSecrets.getOrDefault(registeredClient.getClientId(), List.of());
				for (String fallback : fallbacks) {
					if (passwordEncoder.matches(rawSecret, fallback)) {
						return; // matched a fallback
					}
				}

				throw new BadCredentialsException("Invalid client secret (checked all known secrets)");
			}
		}

		@Bean
		public AuthenticationProvider customClientAuthProvider(
			RegisteredClientRepository repo,
			PasswordEncoder encoder
		) {
			Map<String, List<String>> fallbackSecrets = Map.of(
				"service-a", List.of(
					encoder.encode("old-secret-456"),
					encoder.encode("old-secret-789")
				)
			);
			return new MultiSecretClientAuthenticationProvider(repo, encoder, fallbackSecrets);
		}

		@Bean
		public SecurityFilterChain authServerSecurityFilterChain(HttpSecurity http, AuthenticationProvider customClientAuthProvider) throws Exception {
			OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);
			http.authenticationProvider(customClientAuthProvider);
			return http.build();
		}

		é€™æ¨£ä½ å°±èƒ½æ”¯æ´ã€Œè¼ªæ›¿ä¸­ã€çš„å¤šæŠŠ client_secret ä¸¦è®“é©—è­‰æµç¨‹å¹³æ»‘ä¸ä¸­æ–·ã€‚

  æ™‚é–“ç·š â†’
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  éšæ®µä¸€    â”‚   éšæ®µäºŒ   â”‚   éšæ®µä¸‰   â”‚
  â”‚ æ”¯æ´é›™å¯†ç¢¼ â”‚ Client åˆ‡æ›â”‚ ç§»é™¤èˆŠå¯†ç¢¼ â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
	 â†‘               â†‘               â†‘
   Auth æ›´æ–°       Client æ›´æ–°     Auth æ¸…ç†

	é€™æ¨£åšçš„å¥½è™•
		| å„ªé»           | èªªæ˜                                       |
		| -------------- | ------------------------------------------ |
		| âœ… å®‰å…¨        | Client secret ä¸æœƒä¸€ç›´ä¸æ›ï¼Œé™ä½é¢¨éšª       |
		| âœ… é›¶ä¸­æ–·      | é›™å¯†ç¢¼æ”¯æ´æœŸé–“ï¼Œclient ç„¡ç¸«æ›å¯†ç¢¼          |
		| âœ… å¯è§€å¯Ÿ/å¯©æ ¸ | å¯ä»¥è¨˜éŒ„åˆ‡æ›ç‹€æ…‹èˆ‡ç¨½æ ¸å“ªäº› client å°šæœªæ›´æ–° |

	ğŸ§  å°çµ
		| å•é¡Œ                                   | å›ç­”                                     |
		| -------------------------------------- | ---------------------------------------- |
		| `client_secret` æ›¿æ›é †åºæ‡‰è©²èª°å…ˆèª°å¾Œï¼Ÿ | âœ… Auth Server å…ˆæ”¯æ´é›™å¯†ç¢¼ï¼Œclient å†æ› |
		| æ˜¯å¦èƒ½åšåˆ°ä¸ä¸­æ–·è¼ªæ›¿ï¼Ÿ                 | âœ… å¯ä»¥ï¼Œæ­é… fallback secret å’Œé›™é©—è­‰   |
		| æ›å®Œæ˜¯å¦è¦è¨˜å¾—ç§»é™¤èˆŠå¯†ç¢¼ï¼Ÿ             | âœ… å¿…é ˆï¼Œé¿å…æ°¸ä¹…å­˜æ´»é€ æˆé¢¨éšª            |


	å¦‚æœä¸ä¸Šä¸‹æœå‹™è€Œæ˜¯é€é spring cloud config å‹•æ…‹åˆ·æ–°æ›´æ£’
		æ­é… Spring Cloud Config + å‹•æ…‹åˆ·æ–°ï¼ˆå¦‚ Spring Cloud Busï¼‰ï¼Œé‚£éº¼é€£æœå‹™ä¸Šä¸‹éƒ½ä¸ç”¨ï¼Œclient_secret çš„æ›´æ–°å°±èƒ½æ›´ç„¡ç¸«ã€å³æ™‚ç”Ÿæ•ˆ

	âœ… å…·é«”åšæ³•èˆ‡æµç¨‹
		ä½¿ç”¨ Spring Cloud Config + Spring Cloud Bus æ­é…æ–¹å¼ï¼š
		1.Auth Server ä½¿ç”¨ @ConfigurationProperties ç¶å®š client_secret å€¼

		2.ç”± Spring Cloud Config Server æä¾›æ›´æ–°å¾Œçš„ YAMLï¼ˆæˆ– Git å¾Œç«¯ï¼‰

		3.ä½¿ç”¨ Spring Cloud Bus ç™¼ä½ˆ /actuator/bus-refresh
			â†’ æ‰€æœ‰ Auth Server ç¯€é»å³æ™‚åˆ·æ–° secret å…§å®¹

		4.RegisteredClient è¨»å†Šé‚è¼¯ä¸é‡å•Ÿã€ä¸ä¸Šä¸‹æœå‹™ï¼Œç›´æ¥ç”Ÿæ•ˆ âœ…

	âœ… å„ªé»å°æ¯”
		æ¨¡å¼							æ˜¯å¦ä¸Šä¸‹æœå‹™ï¼Ÿ	å®‰å…¨æ€§	è‡ªå‹•åŒ–ç¨‹åº¦		ç¶­é‹é›£åº¦
		å‚³çµ±ä¸Šä¸‹ç·šæ› secret				âŒ è¦ä¸Šä¸‹æœå‹™	âœ… é«˜	âŒ æ‰‹å‹•			âš ï¸ å®¹æ˜“éŒ¯èª¤
		æ”¯æ´ fallback é›™é©—è­‰æ¨¡å¼		âœ… ä¸ä¸­æ–·		âœ… é«˜	âœ… ä¸€åŠè‡ªå‹•		ğŸŸ¡ ç¨éœ€äººå·¥ç›£æ§
		â˜ï¸ Spring Cloud Config + Bus	âœ… ç„¡éœ€ä¸Šä¸‹æœå‹™	âœ… é«˜	âœ…âœ… é«˜			âœ… æ˜“ç¶­é‹

	âœ…è£œå……å»ºè­°ï¼šå®‰å…¨ + è‡ªå‹•åŒ–æ•´åˆ
		| å»ºè­°é¢å‘               | èªªæ˜                                                                |
		| ------------------ ----| ------------------------------------------------------------------- |
		| ğŸ” å¯†ç¢¼ç®¡ç†            | secret å„²å­˜åœ¨ Git repo å‰å»ºè­°åŠ å¯†ï¼ˆä½¿ç”¨ Spring Vault æˆ– KMSï¼‰       |
		| ğŸ” secret rotation     | å¯å®šæœŸé€é Git PR + Jenkins/GitHub Action ç™¼ä½ˆæ–° secret             |
		| ğŸ”„ é›™ secret æ¨¡å¼      | ä¹Ÿå¯åœ¨ config ä¸­åŒæ™‚ä¿ç•™ `activeSecret` / `backupSecret` åšå¹³æ»‘éæ¸¡ |
		| ğŸ”” secret æ›´æ–°é€šçŸ¥     | æ­é… Slack/Jira webhook æé†’åœ˜éšŠæ›´æ–°å°æ‡‰ä½¿ç”¨è€…è¨­å®š                  |
	âœ… å°çµ
		| å•é¡Œ                                         | å›ç­”                                              |
		| -------------------------------------------- | ------------------------------------------------- |
		| Spring Cloud Config + Bus èƒ½å¦é¿å…ä¸Šä¸‹æœå‹™ï¼Ÿ | âœ… çµ•å°å¯ä»¥ï¼Œæ˜¯æœ€ä½³å¯¦å‹™ä¹‹ä¸€                       |
		| èƒ½å³æ™‚æ›´æ–° `client_secret` å—ï¼Ÿ              | âœ… å¯ä»¥ï¼Œæ­é… `@RefreshScope` æˆ– ConfigProperties |
		| æ˜¯å¦å»ºè­°æ­é…é›™ secret çµæ§‹ä¸€èµ·ä½¿ç”¨ï¼Ÿ         | âœ… æ›´å®‰å…¨ã€éæ¸¡æœŸæ§åˆ¶å½ˆæ€§æ›´é«˜                     |



ğŸšª å¸¸è¦‹ OAuth2 Auth Server ä½¿ç”¨çš„ Portï¼š
	| Port            | èªªæ˜                                                       |
	| --------------- | ---------------------------------------------------------- |
	| **443**         | æœ€å¸¸è¦‹çš„æ­£å¼ç’°å¢ƒ portï¼ˆHTTPSï¼Œç¬¦åˆå®‰å…¨æ€§éœ€æ±‚ï¼‰ âœ…          |
	| **80**          | HTTP é è¨­ portï¼Œåƒ…é™æ–¼æ¸¬è©¦æˆ–å…§ç¶²ç’°å¢ƒï¼Œä¸å»ºè­°æ­£å¼ä½¿ç”¨ âŒ    |
	| **8080**        | é–‹ç™¼ç’°å¢ƒå¸¸ç”¨ï¼ˆHTTPï¼‰ï¼Œæ–¹ä¾¿æœ¬æ©Ÿæ¸¬è©¦                         |
	| **8443**        | é–‹ç™¼ç’°å¢ƒçš„ HTTPS å¸¸è¦‹ portï¼ˆTomcat é è¨­ SSL portï¼‰         |
	| **9000 / 9090** | æœ‰äº›å…¬å¸æˆ–å°ˆæ¡ˆæœƒè‡ªè¨‚å¸¸è¦‹ç¯„åœä½œç‚º OAuth server port         |



spring boot Oauth2 æä¾›
	AuthorizationServerSettings è¨­å®šå¸¸è¦‹å¯ç”¨å®¢åˆ¶è¨­å®š
		è¨­å®š Auth Server ç™¼è¡Œçš„åŸºæœ¬è³‡è¨Š
			1.OAuth 2.0 metadata (/.well-known/openid-configuration)
			2.Token endpoint (/oauth2/token)
			3.Authorization endpoint (/oauth2/authorize)
			4.Issuer claim (iss)
			5.å…¶ä»–ç«¯é»ï¼ˆå¦‚ JWK Setã€introspectionã€revocationï¼‰

			@Bean
			public AuthorizationServerSettings authorizationServerSettings() {
				return AuthorizationServerSettings.builder()
					.issuer("https://auth.example.com") // é€šå¸¸è¦è¨­å®šç‚ºå…¬é–‹çµ¦ client é©—è­‰ JWT çš„ç¶²å€
					.authorizationEndpoint("/oauth2/authorize")
					.tokenEndpoint("/oauth2/token")
					.jwkSetEndpoint("/oauth2/jwks")
					.tokenRevocationEndpoint("/oauth2/revoke")
					.tokenIntrospectionEndpoint("/oauth2/introspect")
					.build();
			}
		
		èªªæ˜å„è¨­å®šé …ï¼š
			| è¨­å®šé …ç›®                     | èªªæ˜                                                                                                               |
			| ---------------------------- | ------------------------------------------------------------------------------------------------------------------ |
			| `issuer(String)`             | **æœ€é‡è¦é …ç›®ä¹‹ä¸€**ï¼ŒJWT çš„ `iss` æ¬„ä½ï¼Œä»¥åŠ Resource Server é©—è­‰æ™‚éœ€ç”¨åˆ°ï¼›å»ºè­°è¨­å®šç‚º Auth Server çš„å°å¤– base URLã€‚ |
			| `authorizationEndpoint`      | OAuth2 èªè­‰ç«¯é»ï¼ˆé è¨­ `/oauth2/authorize`ï¼‰ï¼Œå‰ç«¯å°å‘ç”¨æˆ¶æˆæ¬Šæ™‚æœƒèµ°é€™è£¡ã€‚                                          |
			| `tokenEndpoint`              | ç”¨æ–¼ token ç™¼è¡Œï¼Œä¾‹å¦‚ Client Credentials flowã€‚é è¨­ç‚º `/oauth2/token`ã€‚                                            |
			| `jwkSetEndpoint`             | JWT å…¬é‘°çš„å–å¾—ä½ç½®ï¼ŒResource Server é©—ç°½æ™‚æœƒä¾†é€™è£¡æ‹¿ã€‚é è¨­ `/oauth2/jwks`ã€‚                                        |
			| `tokenRevocationEndpoint`    | æä¾› Client ä¸»å‹•æ’¤éŠ· token çš„ endpointã€‚                                                                           |
			| `tokenIntrospectionEndpoint` | æä¾› resource server æŸ¥è©¢ token ç‹€æ…‹çš„ endpointã€‚                                                                  |

		æ³¨æ„ï¼š
			* å¦‚æœä¸æŒ‡å®šé€™äº›æ¬„ä½ï¼ŒSpring Authorization Server æœƒä½¿ç”¨ é è¨­è·¯å¾‘ã€‚
			* ä½†æœ€å°‘è¦è¨­å®š issuer()ï¼Œå¦å‰‡ä¸€äº› grant typeï¼ˆä¾‹å¦‚ JWTï¼‰æœƒé©—è­‰å¤±æ•—ï¼Œå°¤å…¶æ˜¯ Resource Server æœƒé©—è­‰ iss claim èˆ‡è‡ªå·±çš„è¨­å®šæ˜¯å¦ä¸€è‡´ã€‚
			* issuer é€šå¸¸ç‚ºå¤–éƒ¨å¯ä»¥å­˜å–çš„å®Œæ•´ç¶²å€ï¼Œä¾‹å¦‚ï¼š
				https://auth.mycompany.com
				http://localhost:9000 ï¼ˆåƒ…ä¾›æœ¬æ©Ÿæ¸¬è©¦ï¼‰

		å»¶ä¼¸è£œå……ï¼š
			AuthorizationServerSettings å°æ‡‰çš„ metadata æœƒå‘ˆç¾åœ¨é€™å€‹ endpointï¼š
				GET /.well-known/openid-configuration
			é¡¯ç¤ºçš„å…§å®¹å¦‚ä¸‹ï¼ˆæ ¹æ“šè¨­å®šè€Œä¸åŒï¼‰ï¼š
				{
				  "issuer": "https://auth.example.com",
				  "authorization_endpoint": "https://auth.example.com/oauth2/authorize",
				  "token_endpoint": "https://auth.example.com/oauth2/token",
				  ...
				}
			é€™äº›è³‡è¨Šæœƒçµ¦å‰ç«¯æˆ–å¤–éƒ¨æ•´åˆç³»çµ±ç•¶ discovery ä½¿ç”¨ã€‚
			
			å¦‚ä½ æœ‰å¤šå€‹ç’°å¢ƒï¼ˆdev, sit, prodï¼‰ï¼Œå¯ä»¥è®“ issuer éš¨ Spring Profile æˆ–ç’°å¢ƒè®Šæ•¸è¨­å®šï¼Œä¾‹å¦‚ï¼š
				# application-prod.yml
				auth-server:
				  issuer: https://auth.prod.mycompany.com

				@Bean
				AuthorizationServerSettings authorizationServerSettings(
					@Value("${auth-server.issuer}") String issuer
				) {
					return AuthorizationServerSettings.builder().issuer(issuer).build();
				}
