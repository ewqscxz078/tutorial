é©—è­‰ jwt æ¸¬è©¦æµç¨‹
	Q:ç•¶æˆ‘ client A with jwt by auth server å–å¾—ä¸¦æ‰“åˆ° client A backend å¾Œï¼Œclient A backend åˆ° resource server é©—è­‰ jwt
		å¦‚æœæˆ‘é‚„æ²’æœ‰ä½ˆç½²åˆ° ç’°å¢ƒæ™‚ï¼Œæœ¬æ©Ÿæ¸¬è©¦æ€æ¨£æ‰ç®—æ°ç•¶æ¸¬è©¦?

	A: æ¸¬è©¦æƒ…å¢ƒé‡è¿°
		1.client A frontendï¼šå‘ Auth Server æ‹¿ JWTï¼ˆé€é client_id / client_secret æˆ–ç™»å…¥æµç¨‹ï¼‰
		2.client A backendï¼šæ”¶åˆ° JWT å¾Œï¼Œè½‰é€ API è«‹æ±‚ï¼Œé™„å¸¶ JWT
		3.resource serverï¼ˆå¦ä¸€å€‹ backendï¼‰ï¼šé©—è­‰ JWTï¼ˆé€šå¸¸æ˜¯ RS256 æ†‘ç°½åï¼‰
			ğŸ” å•é¡Œæ˜¯ï¼šåœ¨ã€Œæœ¬æ©Ÿæ¸¬è©¦ã€ç’°å¢ƒä¸‹ï¼Œæ€æ¨£æ‰ç®—æ˜¯æœ‰ã€Œæ­£ç¢ºé©—è­‰ JWTã€ï¼Ÿ

		æ°ç•¶çš„æœ¬æ©Ÿæ¸¬è©¦ä½œæ³•
			1. åœ¨æœ¬æ©Ÿå•Ÿå‹• å®Œæ•´ Auth Server
				è®“ä½ æœ¬åœ°çš„å‰ç«¯æˆ–æ¸¬è©¦å·¥å…·ï¼ˆå¦‚ curlã€Postmanï¼‰å¾æœ¬åœ° Auth Server å¯¦éš›å–å¾— JWTã€‚
					* ç”¨ Spring Authorization Server

					* å•Ÿå‹•å¾Œæœƒæœ‰ /oauth2/tokenã€/.well-known/jwks.json

					* ç™¼å‡º JWTï¼Œå…§å« RS256 æˆ– HS256 ç°½å

				æ¸¬å‡ºä¾†çš„ JWT æ˜¯çœŸå¯¦çš„ã€æœ‰ç°½ç« ã€åˆæ³•çš„

			2. æœ¬åœ° resource server ä½¿ç”¨ã€Œèˆ‡ Auth Server å°æ‡‰çš„ JWT é©—è­‰è¨­å®šã€
				Spring Boot Resource Server è¨­å®šç¯„ä¾‹ï¼ˆRS256 æ¨¡å¼ï¼‰ï¼š
					spring:
					  security:
						oauth2:
						  resourceserver:
							jwt:
							  issuer-uri: http://localhost:9000
				é€™æ¨£ Spring Security å°±æœƒè‡ªå‹•å» Auth Server çš„
					http://localhost:9000/.well-known/openid-configuration
					http://localhost:9000/oauth2/jwks
					æŠ“å–å…¬é‘°ä¾†é©—è­‰ JWTã€‚

					âœ… æ¸¬è©¦æ™‚å°±æœƒçœŸçš„é©—ç°½ã€çœŸçš„æ‹’çµ•ç„¡æ•ˆ tokenã€‚

			3. è‹¥æœ¬æ©Ÿæ¸¬è©¦ç„¡æ³•å•Ÿå¤šå€‹æœå‹™ï¼Œæ€éº¼è¾¦ï¼Ÿ
				å¯ä»¥ æ¨¡æ“¬ Resource Server JWT é©—è­‰ï¼Œç”¨ä»¥ä¸‹å…©ç¨®æ–¹å¼ï¼š
					æ–¹å¼ä¸€ï¼šMock Auth Server çš„ JWKS
						* å°‡ Auth Server çš„ jwks.json ä¸‹è¼‰ä¸‹ä¾†
						* åœ¨ Resource Server ä¸­æ‰‹å‹•æŒ‡å®š public keyï¼š
							spring:
							  security:
								oauth2:
								  resourceserver:
									jwt:
									  jwk-set-uri: file:./local-jwks.json
					æ–¹å¼äºŒï¼šä½¿ç”¨ WireMock æˆ– TestContainer å•Ÿå‹•æ¨¡æ“¬ JWKS server
						* å»ºä¸€å€‹ fake jwks endpoint
						* æ¨¡æ“¬ token é©—è­‰æµç¨‹ï¼Œæ¸¬è©¦æ•´é«”ä¸²æ¥é‚è¼¯è€Œé token çœŸå¯¦æœ‰æ•ˆæ€§

			4. æ¸¬è©¦ JWT é©—è­‰å¤±æ•—çš„ç‹€æ³
				ä½ æ‡‰è©²åœ¨æœ¬åœ°åšå¹¾ç¨®è² é¢æ¸¬è©¦ï¼š

				æ¸¬è©¦é …ç›®					é æœŸè¡Œç‚º
				ç¼ºå°‘ Authorization header	å›å‚³ 401
				JWT éæœŸ					å›å‚³ 401 (token expired)
				JWT ç°½åéŒ¯èª¤				å›å‚³ 401 (invalid signature)
				JWT æ²’æœ‰å¿…è¦ scope			å›å‚³ 403 (access denied)

				âœ… Spring Security æœƒæ ¹æ“š token é©—è­‰çµæœè‡ªå‹•è™•ç†é€™äº›æƒ…æ³ï¼Œé©åˆæ•´åˆæ¸¬è©¦ã€‚

		çµè«–ï¼šæœ¬æ©Ÿæ¸¬è©¦æ˜¯å¦ç®—ã€Œæ°ç•¶ã€çš„æ¢ä»¶
			æ¸¬è©¦æ¢ä»¶									èªªæ˜
			âœ… JWT æ˜¯å¾æœ¬åœ°å•Ÿå‹•çš„ Auth Server æ‹¿çš„		è¡¨ç¤º token æ˜¯åˆæ³•ç”¢ç”Ÿçš„
			âœ… Resource Server èƒ½é©—è­‰é€™å€‹ token			è¡¨ç¤º JWT é…ç½®æ˜¯å°çš„ï¼ˆissuer-uri / jwks å¯ç”¨ï¼‰
			âœ… æœ‰è™•ç†æ­£è² é¢é©—è­‰æƒ…å¢ƒ						è¡¨ç¤ºä½ çš„æ¬Šé™æ§åˆ¶è¡Œç‚ºæ˜¯å®Œæ•´çš„
			âœ… æ‰€æœ‰ç«¯é»å¯ä¸²æ¥ã€è§’è‰²è¨­å®šå¯ç”¨				è¡¨ç¤ºå¯¦éš›é‹è¡Œæœƒå’Œæœ¬æ©Ÿæƒ…å¢ƒä¸€è‡´ï¼Œä¸æœƒå¤šèµ°å¾Œé–€æˆ–å¿½ç•¥é©—è­‰


åƒ…æ¸¬è©¦ client A frontend åˆ° client A backendï¼Œä½†ç•¥é jwt é©—è­‰
	âœ… å‰ç«¯æœ‰å‘¼å« Auth Server æ‹¿ token
	âœ… å¾Œç«¯æœ‰é©—è­‰ JWT æ˜¯å¦åˆæ³•ï¼ˆResource Server åŠŸèƒ½ï¼‰
	âŒ ä½†ä½ æœ¬æ©Ÿæ¸¬è©¦æ™‚ä¸æƒ³çœŸçš„å»å–å¾— JWT / é©—è­‰ JWTï¼Œæƒ³ã€Œç•¥é token çš„å–å¾—èˆ‡é©—è­‰éç¨‹ã€ï¼Œä½†åˆã€Œä¿ç•™ç¨‹å¼ç¢¼æµç¨‹å®Œæ•´æ€§ã€

	æµç¨‹é‚è¼¯å®Œæ•´ä¿ç•™ï¼Œä½†æœ¬æ©Ÿæ¸¬è©¦æ™‚ä¸ä¾è³´ Auth Server å­˜æ´»æˆ– JWT çœŸå¯¦ç°½åé©—è­‰

	ç¹é JWT é©—è­‰ï¼ˆMock Token é©—è­‰ï¼‰
		âœ… æ–¹å¼ä¸€ï¼šæœ¬åœ° profile æ”¹æˆ mock JWT é©—è­‰é‚è¼¯
			Spring Security å®¹è¨±ä½ è‡ªè¨‚ JwtDecoder ä¾†æ§åˆ¶æ€éº¼é©—è­‰ tokenï¼Œä½ å¯ä»¥åœ¨ dev ç’°å¢ƒé€™æ¨£åš
				application-dev.yml
					spring:
					  security:
						oauth2:
						  resourceserver:
							jwt:
							  issuer-uri: mock
				è‡ªè¨‚å‡çš„ JwtDecoder Bean
					@Profile("dev")
					@Configuration
					public class DevSecurityConfig {

						@Bean
						public JwtDecoder jwtDecoder() {
							return token -> {
								Map<String, Object> claims = Map.of(
									"sub", "mock-user",
									"scope", "read write"
								);
								return Jwt.withTokenValue(token)
										.header("alg", "none")
										.claims(c -> c.putAll(claims))
										.issuedAt(Instant.now())
										.expiresAt(Instant.now().plusSeconds(3600))
										.build();
							};
						}
					}
				é€™æ¨£ä½ æœ¬æ©Ÿæ¸¬è©¦æ™‚ï¼š
					* token æ˜¯å‡çš„ï¼Œä½†ç¨‹å¼æœƒç…§æ¨£è·‘

					* Spring Security è¦–ç‚ºåˆæ³•çš„ JWT

					* @PreAuthorize("hasAuthority('SCOPE_read')") ç­‰éƒ½æœƒç…§æ¨£ç”Ÿæ•ˆ
		âœ… æ–¹å¼äºŒï¼šMock æ‰ Auth Serverï¼Œå‰ç«¯ä¹Ÿç›´æ¥ç”¨å‡çš„ token
			å»ºä¸€å€‹ç°¡å–®çš„ æœ¬åœ° fake Auth Server endpointï¼Œç›´æ¥å›ä¸€å€‹ hardcoded JWT çµ¦å‰ç«¯
				@RestController
				@Profile("dev")
				public class FakeTokenController {

					@PostMapping("/oauth2/token")
					public Map<String, String> getFakeToken() {
						return Map.of("access_token", "mock-token", "token_type", "Bearer", "expires_in", "3600");
					}
				}
			client A frontend ç›´æ¥ç”¨é€™å€‹ token ä¸²å¾Œç«¯æ¸¬è©¦ã€‚

		çµè«–ï¼šä½ å¯ä»¥é”åˆ°ã€Œç¨‹å¼ç¢¼ä¸æ”¹ï¼Œä½†æ¸¬è©¦æ™‚ç•¥éçœŸå¯¦é©—è­‰ã€çš„ç›®æ¨™
			| æ–¹å¼            | é©ç”¨               | ä¿ç•™é©—è­‰æµç¨‹ï¼Ÿ | éœ€è¦ Auth Server å­˜æ´»ï¼Ÿ |
			| --------------- | ------------------ | -------------- | ------------------ |
			| Mock JwtDecoder | æœ¬åœ°æ¸¬è©¦æ™‚æœ€æ¨è–¦   | âœ…             | âŒ                  |
			| Fake Auth API   | å‰å¾Œç«¯ä¸²æ¥æ¸¬è©¦     | âœ…             | âŒ                  |
			| çœŸå¯¦ Auth+RS    | æ•´åˆ/ç³»çµ±æ¸¬è©¦      | âœ…             | âœ…                  |
