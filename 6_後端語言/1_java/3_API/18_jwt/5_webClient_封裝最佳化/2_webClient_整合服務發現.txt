ref ChatGPT

webClient å¯ä»¥æ•´åˆ spring cloud çš„æœå‹™ç™¼ç¾
	æ•´åˆ Spring Cloud çš„æœå‹™ç™¼ç¾æ©Ÿåˆ¶ï¼ˆå¦‚ Eurekaã€Consulï¼‰ï¼Œè®“ä½ ç›´æ¥ç”¨ service name ç•¶ URI çš„ hostï¼Œè€Œä¸å¿…å¯«æ­» IP æˆ– port


ğŸ”§ ä½¿ç”¨æ¢ä»¶ï¼š
	è¦é”æˆ WebClient æ•´åˆæœå‹™ç™¼ç¾ï¼Œå¿…é ˆæ­é… spring-cloud-starter-loadbalancer æˆ– Spring Cloud Gatewayã€‚


âœ… ä½¿ç”¨æ–¹å¼ä¸€ï¼šSpring Cloud LoadBalancer æ¨¡å¼ï¼ˆæ¨è–¦ï¼‰
	ğŸ“¦ 1. å¼•å…¥å¿…è¦ä¾è³´
		<dependency>
		  <groupId>org.springframework.boot</groupId>
		  <artifactId>spring-boot-starter-webflux</artifactId>
		</dependency>
		<dependency>
		  <groupId>org.springframework.cloud</groupId>
		  <artifactId>spring-cloud-starter-loadbalancer</artifactId>
		</dependency>
		<dependency>
		  <groupId>org.springframework.cloud</groupId>
		  <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
		</dependency>

	ğŸ› ï¸ 2. å»ºç«‹æ”¯æ´ loadbalancer çš„ WebClient.Builder
		@Configuration
		public class WebClientConfig {

			@Bean
			@LoadBalanced  // é—œéµï¼
			public WebClient.Builder loadBalancedWebClientBuilder() {
				return WebClient.builder();
			}
		}

	âœ… 3. ä½¿ç”¨æ™‚ç›´æ¥ç”¨æœå‹™åç¨±ç•¶ä¸»æ©Ÿï¼š
		@Service
		public class OrderServiceClient {

			private final WebClient webClient;

			public OrderServiceClient(@Qualifier("loadBalancedWebClientBuilder") WebClient.Builder builder) {
				this.webClient = builder.build();
			}

			public Mono<String> getOrder() {
				return webClient.get()
						.uri("http://order-service/api/orders")  // ä½¿ç”¨ Eureka è¨»å†Šçš„ serviceId
						.retrieve()
						.bodyToMono(String.class);
			}
		}

	âœ… WebClient + Spring Cloud Eureka çš„ DNS è§£æé‚è¼¯ï¼š
		| URI host                              | è§£é‡‹                                                           |
		| ------------------------------------- | -------------------------------------------------------------- |
		| `http://order-service`                | â†’ ç”± `@LoadBalanced` + `LoadBalancerClient` æ‰¾å‡ºå°æ‡‰ IP\:port  |
		| `http://localhost:8081`               | â†’ ä¸æœƒèµ° Eureka                                                |
		| `lb://order-service`ï¼ˆåœ¨æŸäº› lib ä¸­ï¼‰ | æ˜ç¢ºå®£å‘Šèµ° load balancerï¼ˆä½†ä¸æ˜¯ WebClient çš„æ¨™æº–ç”¨æ³•ï¼‰        |

	ğŸš« æ³¨æ„äº‹é …
		| å•é¡Œ                                               | è§£æ³•                                        |
		| -------------------------------------------------- | ------------------------------------------- |
		| WebClient æ²’åŠ  `@LoadBalanced`                     | âŒ æœƒå ± `UnknownHostException`              |
		| ä¸èƒ½ç›´æ¥ç”¨ `WebClient.create(...)`                 | âŒ ä¸æœƒèµ° load balancerï¼Œé™¤éè‡ªå·±è™•ç†       |
		| è‹¥æœ‰ Ribbonï¼ˆè€ç‰ˆï¼‰æˆ– Gatewayï¼Œè«‹ç”¨æ–° LoadBalancer | Spring Cloud 2021+ æ¨è–¦æ–° loadbalancer æ©Ÿåˆ¶ |

	âœ… ç¸½çµ
		| æ˜¯å¦å¯æ•´åˆæœå‹™ç™¼ç¾ï¼Ÿ     | âœ… å¯ä»¥                                   |
		| å¯¦ç¾æ–¹å¼                 | åŠ  @LoadBalanced çš„ WebClient.Builder     |
		| æ”¯æ´è² è¼‰å¹³è¡¡             | âœ… æœƒå¾å¤šå€‹å¯¦ä¾‹ä¸­é¸ä¸€å€‹ï¼ˆround robin ç­‰ï¼‰ |
		| URI ä½¿ç”¨æ–¹å¼             | http://<serviceId>/path                   |