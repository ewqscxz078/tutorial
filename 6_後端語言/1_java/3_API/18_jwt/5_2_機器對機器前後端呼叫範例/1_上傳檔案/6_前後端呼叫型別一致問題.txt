ref ChatGPT


è‹¥å‰å¾Œç«¯ç„¡ä½¿ç”¨ä¸€è‡´å‹åˆ¥ï¼Œæ²’æœ‰ç·¨è­¯æœŸå‹åˆ¥æª¢æŸ¥ï¼Œä¸€æ—¦å¾Œç«¯æ”¹äº†è·¯å¾‘ã€åƒæ•¸ã€å›å‚³æ ¼å¼ï¼Œ
	å‰ç«¯ä¸æœƒå ±éŒ¯ï¼Œåªæœƒåœ¨åŸ·è¡Œæ™‚çˆ†ç‚¸

	| å•é¡Œ               | èªªæ˜                                                                  |
	| ------------------ | --------------------------------------------------------------------- |
	| âš ï¸ ç„¡ç·¨è­¯éŒ¯èª¤æç¤º  | Controller æ”¹äº† URL æˆ–åƒæ•¸ï¼ŒFeign ä¸æœƒå‡ºéŒ¯ï¼Œåªæœ‰ runtime 500 / 404    |
	| âŒ JSON çµæ§‹è®Šäº†   | å›å‚³æ ¼å¼è®Šæ›´æœƒé€ æˆ Feign ç„¡æ³•è½‰å‹ï¼ˆ`HttpMessageConversionException`ï¼‰ |
	| ğŸ§ª é›£æ¸¬è©¦          | æ²’æœ‰å–®ä¸€é»èƒ½ä¿è­‰é›™æ–¹å”è­°ä¸€è‡´æ€§                                        |

è£œä¸Šå‹åˆ¥ä¸€è‡´æ€§èˆ‡é©—è­‰
	FeignClient
		âœ… è§£æ³• 1ï¼šæŠ½å…±ç”¨ interface èˆ‡ DTO åˆ° shared-interface module
			// shared-interface
			public interface OrderApi {
				@GetMapping("/api/orders")
				String getOrders();
			}
			Client A ä½¿ç”¨ FeignClient å¯¦ä½œé€™å€‹ä»‹é¢ï¼š
				@FeignClient(name = "clientB", url = "${client-b.api-url}")
				public interface ClientBFeignClient extends OrderApi {}

			Client B çš„ Controller ä¹Ÿ implements ç›¸åŒä»‹é¢ï¼š
				@RestController
				public class OrderController implements OrderApi {
					@Override
					public String getOrders() {
						return "Order List";
					}
				}
			åªè¦ä»‹é¢æœ‰ç•°å‹•ï¼Œå‰å¾Œç«¯éƒ½æœƒæ”¶åˆ°ç·¨è­¯éŒ¯èª¤æé†’ï¼

		âœ… è§£æ³• 2ï¼šä½¿ç”¨ OpenAPI Generatorï¼ˆæ¨è–¦çµ¦å¤§å‹å°ˆæ¡ˆï¼‰
			* ç”¨ Springdoc ç”¢ç”Ÿ OpenAPI 3 è¦æ ¼ (/v3/api-docs)

			* ç”¨ openapi-generator ç”¢ç”Ÿ FeignClient/Typescript/Java SDK

			* å‰ç«¯ / å…¶ä»–æœå‹™å°±ä¸éœ€è¦æ‰‹åˆ» FeignClientï¼Œè€Œæ˜¯å¾è¦æ ¼è‡ªå‹•ç”¢ç”Ÿ
				openapi-generator-cli generate \
				  -i http://localhost:8080/v3/api-docs \
				  -g java \
				  -o ./generated-client \
				  --library spring-cloud
		ã€Œå¥‘ç´„è„«é‰¤é¢¨éšªã€
			| åšæ³•                 | å‹åˆ¥é©—è­‰        | ç¶­è­·æˆæœ¬            | éˆæ´»æ€§         |
			| -------------------- | --------------- | ------------------- | -------------- |
			| æ‰‹åˆ» FeignClient     | âŒ ç„¡å‹åˆ¥æª¢æŸ¥   | ä¸­                  | é«˜             |
			| å…±ç”¨ interface / DTO | âœ… ç·¨è­¯æœŸå¯æª¢æŸ¥ | ä¸­ä½                | ä¸­             |
			| OpenAPI Generator    | âœ… æœ€åš´è¬¹       | é«˜ï¼ˆè¦ CI/CD æ•´åˆï¼‰ | ä½ï¼ˆè¼ƒä¸éˆæ´»ï¼‰ |

		ğŸ§± æ¶æ§‹æ¦‚å¿µåœ–ï¼š
			common-interface-dto (Maven module or library)
			â”œâ”€â”€ OrderRequest.java
			â”œâ”€â”€ OrderResponse.java
			â””â”€â”€ OrderApi.java          <-- é€™æ˜¯å…±ç”¨ interfaceï¼Œå®šç¾© REST è¦æ ¼

			backend-service
			â””â”€â”€ OrderController.java   <-- implements OrderApi

			frontend-service (Java-based frontend æˆ– Feign å‘¼å«æ–¹)
			â””â”€â”€ OrderClient.java       <-- @FeignClient + implements OrderApi


			ğŸ“ common-interface-dto å°ˆæ¡ˆ
				// OrderRequest.java
				@Data
				public class OrderRequest {
					private String userId;
				}

				// OrderResponse.java
				@Data
				public class OrderResponse {
					private String orderId;
					private String status;
				}

				// OrderApi.java
				@RequestMapping("/api/orders")
				public interface OrderApi {

					@PostMapping
					OrderResponse createOrder(@RequestBody OrderRequest request);

					@GetMapping("/{id}")
					OrderResponse getOrder(@PathVariable String id);
				}

			ğŸ“ å¾Œç«¯å°ˆæ¡ˆå¯¦ä½œï¼ˆResource Serverï¼‰
				@RestController
				public class OrderController implements OrderApi {

					@Override
					public OrderResponse createOrder(OrderRequest request) {
						return new OrderResponse("ORD123", "CONFIRMED");
					}

					@Override
					public OrderResponse getOrder(String id) {
						return new OrderResponse(id, "CONFIRMED");
					}
				}

			ğŸ“ å‰ç«¯æˆ–å‘¼å«ç«¯ï¼ˆä½¿ç”¨ Feignï¼‰
				@FeignClient(name = "order-api", url = "${order.api.url}")
				public interface OrderClient extends OrderApi {}

				@Autowired
				private OrderClient orderClient;

				public void doWork() {
					OrderResponse res = orderClient.getOrder("ORD123");
				}

		| å„ªé»                             | èªªæ˜                         |
		| -------------------------------- | ---------------------------- |
		| âœ… å‰å¾Œç«¯å¼·å‹åˆ¥ä¸€è‡´              | æ¥å£èˆ‡ DTO éƒ½ä¾†è‡ªåŒä¸€ source |
		| âœ… ç·¨è­¯æœŸç™¼ç¾ç ´å£æ€§è®Šæ›´          | æ”¹éŒ¯åƒæ•¸ã€åˆªæ¬„ä½æœƒç«‹å³å ±éŒ¯   |
		| âœ… æ¸›å°‘é‡å·¥èˆ‡ swagger copy-paste | ç„¡éœ€æ‰‹æŠ„è·¯å¾‘èˆ‡æ¬„ä½           |
		| âœ… å¯åšç‰ˆæœ¬æ§ç®¡ï¼ˆmulti-versionï¼‰ | å¯ç™¼å¸ƒä¸åŒç‰ˆæœ¬çš„ä»‹é¢æ¨¡çµ„     |


	WebClient
		ğŸ“ å…±ç”¨ common-dto å°ˆæ¡ˆï¼ˆçµ¦å‰å¾Œç«¯å…±ç”¨ï¼‰
			// UserRequest.java
			@Data
			public class UserRequest {
				private String userId;
			}

			// UserResponse.java
			@Data
			public class UserResponse {
				private String name;
				private String email;
			}

		âœ… å¾Œç«¯ Controller ä½¿ç”¨ç›¸åŒ DTOï¼š
			@RestController
			@RequestMapping("/api/users")
			public class UserController {

				@PostMapping
				public UserResponse getUser(@RequestBody UserRequest request) {
					return new UserResponse("David", "david@example.com");
				}
			}

		âœ… å‰ç«¯æœå‹™ä½¿ç”¨ WebClient ä¸²æ¥
			@Service
			public class UserService {

				private final WebClient webClient;

				public UserService(WebClient webClient) {
					this.webClient = webClient;
				}

				public UserResponse getUserInfo(String userId) {
					UserRequest req = new UserRequest();
					req.setUserId(userId);

					return webClient.post()
							.uri("http://localhost:8081/api/users")
							.bodyValue(req)
							.retrieve()
							.bodyToMono(UserResponse.class)
							.block();
				}
			}

		âœ… å‹åˆ¥ä¸€è‡´æ€§å¦‚ä½•ä¿è­‰ï¼Ÿ
			| ä¿è­‰æ–¹å¼                      | èªªæ˜                                                               |
			| ----------------------------- | ------------------------------------------------------------------ |
			| ğŸ§© DTO çµ±ä¸€æ”¾åœ¨å…±ç”¨ module    | `common-dto` è¢«å‰å¾Œç«¯ä¸€èµ·å¼•ç”¨                                      |
			| ğŸ“¦ ä½¿ç”¨ç›¸åŒ ObjectMapper è¨­å®š | é¿å…æ—¥æœŸæ ¼å¼ã€enum åç¨±ç­‰ä¸ä¸€è‡´                                    |
			| ğŸ§ª å¯è‡ªå‹•ç”¢ç”Ÿ OpenAPI         | ç”¨ä¾†è‡ªå‹•æ¸¬è©¦ã€æ¯”å°çµæ§‹å·®ç•°                                         |
			| âœ… å¯åŠ ä¸Š schema é©—è­‰ï¼ˆé¸é…ï¼‰ | å¦‚ä½¿ç”¨ `@Validated` + Bean Validationï¼Œé¿å…éŒ¯èª¤æ¬„ä½é€²å…¥ controller |


ğŸ” WebClient vs Feign å‹åˆ¥ä¸€è‡´å°ç…§ï¼š
	| ç‰¹æ€§                      | FeignClient      | WebClient                    |
	| ------------------------- | ---------------- | ---------------------------- |
	| å…±ç”¨ DTO å¯è¡Œ             | âœ…               | âœ…                           |
	| å…±ç”¨ä»‹é¢ï¼ˆinterfaceï¼‰     | âœ… å¾ˆæ–¹ä¾¿        | âŒ éœ€æ‰‹å‹•åŒ…è£æ–¹æ³•            |
	| é«˜å½ˆæ€§ï¼ˆå¦‚ä¸²æµã€timeoutï¼‰ | âŒ æœ‰é™          | âœ… æœ€å®Œæ•´æ§åˆ¶                |
	| é©åˆè‡ªå‹•ç”¢ç”Ÿ client       | âœ… æ­é… OpenAPI  | âœ… æ›´å¥½æ§åˆ¶åƒæ•¸æ ¼å¼èˆ‡ header |

âœ… å°çµå»ºè­°ï¼š
	| æƒ…å¢ƒ                           | å»ºè­°                                 |
	| ------------------------------ | ------------------------------------ |
	| è¦å¿«é€Ÿæ•´åˆ REST API ä¸”çµæ§‹ç°¡å–® | ç”¨ FeignClient + å…±ç”¨ interface      |
	| è¦é€²è¡Œæª”æ¡ˆä¸²æµã€å¤§é‡è¨­å®šæ§åˆ¶   | ç”¨ WebClient + å…±ç”¨ DTO              |
	| æƒ³è‡ªå‹•åŒ–æ–‡ä»¶èˆ‡ client SDK      | ç”¨ OpenAPI + WebClient or Feign çš†å¯ |
