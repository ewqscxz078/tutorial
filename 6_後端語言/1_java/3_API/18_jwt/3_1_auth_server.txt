âœ… æ­¥é©Ÿä¸€ï¼šCI/CD æ±ºå®š client_id / client_secret
	åœ¨ CI/CD pipeline ä¸­ï¼Œç‚ºæ¯å€‹ client é å…ˆç”¢å‡º client_id / client_secretï¼š

		* éš¨æ©Ÿç”¢ç”Ÿ
		* æˆ–ç”± Git repository/éƒ¨ç½²è…³æœ¬è¨­å®š
		* å­˜å…¥ï¼šVault / AWS Secrets Manager / GitHub Actions Secret / K8s Secret / Config Server / CI CD variables

âœ… æ­¥é©ŸäºŒï¼šAuth Server å•Ÿå‹•æ™‚å¾ Secret æ³¨å…¥ï¼Œè¨»å†Š RegisteredClient
	Spring Boot å•Ÿå‹•æ™‚è®€å–ä¾†è‡ª secrets çš„è³‡è¨Šï¼Œåˆå§‹åŒ–è¨»å†Šï¼š
		myauth:
		  clients:
			- clientId: service-a
			  clientSecret: ${CLIENT_A_SECRET}
			  scopes: [read]
			- clientId: service-b
			  clientSecret: ${CLIENT_B_SECRET}
			  scopes: [read, write]

	ç„¶å¾Œè½‰ç‚º RegisteredClient
		@ConfigurationProperties(prefix = "myauth")
		public class MyAuthProperties {
			private List<ClientProperties> clients;
			// getter/setter
		}

		public class ClientProperties {
			private String clientId;
			private String clientSecret;
			private List<String> scopes;
			// getter/setter
		}

		@Bean
		public CommandLineRunner registerClients(MyAuthProperties props,
												 RegisteredClientRepository repo,
												 PasswordEncoder encoder) {
			return args -> {
				for (ClientProperties client : props.getClients()) {
					if (repo.findByClientId(client.getClientId()) == null) {
						RegisteredClient rc = RegisteredClient.withId(UUID.randomUUID().toString())
							.clientId(client.getClientId())
							.clientSecret(encoder.encode(client.getClientSecret()))
							.authorizationGrantType(AuthorizationGrantType.CLIENT_CREDENTIALS)
							.scopes(s -> s.addAll(client.getScopes()))
							.build();
						repo.save(rc);
					}
				}
			};
		}

âœ… æ­¥é©Ÿä¸‰ï¼šCI/CD å°‡ç›¸åŒ secret æ³¨å…¥å°æ‡‰ service
	æ¯å€‹ resource server è¢«éƒ¨ç½²æ™‚ï¼ŒCI/CD å°‡è©²æœå‹™çš„ client_id / client_secret ä¹Ÿæ³¨å…¥é€²å»
		ä¾‹å¦‚ Kubernetes çš„ secret mount
			env:
			  - name: CLIENT_ID
				valueFrom:
				  secretKeyRef:
					name: service-a-oauth
					key: client_id
			  - name: CLIENT_SECRET
				valueFrom:
				  secretKeyRef:
					name: service-a-oauth
					key: client_secret

	æˆ– build æ™‚å¯«å…¥ application.yml
		spring:
		  security:
			oauth2:
			  client:
				registration:
				  myclient:
					client-id: ${CLIENT_ID}
					client-secret: ${CLIENT_SECRET}
âœ… ç¸½çµæµç¨‹
	CI/CD
	  â”œâ”€â”€ æ±ºå®š client_id / secret
	  â”œâ”€â”€ è¨­å®šçµ¦ Auth Server å•Ÿå‹•ç’°å¢ƒè®Šæ•¸
	  â”œâ”€â”€ è¨»å†Šæˆ RegisteredClientï¼ˆSpring Boot å•Ÿå‹•æ™‚ï¼‰
	  â””â”€â”€ æ³¨å…¥åˆ°å°æ‡‰æœå‹™ï¼ˆVault/K8s/env/application.ymlï¼‰

	çµæœï¼š
	  Auth Server æœ‰è³‡æ–™
	  Client ä¹Ÿæœ‰ secret å¯ç”¨ä¾†æ‹¿ token

CI/CD pipeline âœ ç§˜å¯†ç®¡ç†æœå‹™ï¼ˆVault ç­‰ï¼‰ âœ Spring Boot å•Ÿå‹•æ™‚è®€å…¥ âœ åˆå§‹åŒ–å„²å­˜åˆ° JDBC
	ä¹Ÿå°±æ˜¯èªªï¼Œclient_id / client_secret æœ€åˆçš„ä¾†æºæ˜¯ CI/CDï¼ˆæˆ– IaCï¼‰ï¼Œä¸æ˜¯ JDBC æœ¬èº«ï¼ŒJDBC åªæ˜¯ä½œç‚º RegisteredClientRepository çš„å„²å­˜è¼‰é«”è€Œå·²

Q:ç‚ºä»€éº¼ RegisteredClient é‚„æ˜¯è¦å­˜é€² JDBCï¼Ÿ
	A: Authorization Server éœ€è¦çŸ¥é“ã€Œå“ªäº› client æ˜¯åˆæ³•çš„ã€
		curl -u my-client:abc123 https://auth-server/oauth2/token
			Auth Server æœƒå» RegisteredClientRepositoryï¼ˆé€šå¸¸æ˜¯ JDBCï¼‰æŸ¥è©¢æ˜¯å¦æœ‰é€™å€‹ clientï¼š

			å­˜åœ¨ â†’ é©—è­‰ client_secret æ˜¯å¦æ­£ç¢º

			ä¸å­˜åœ¨ â†’ å› 401 Unauthorized

			Auth Server æ˜¯ã€Œå”¯ä¸€çš„çœŸå¯¦ä¾æ“šã€ï¼ŒCI/CD åªæ˜¯å¹«å¿™æº–å‚™è€Œå·²

	A: JDBC æ˜¯ã€Œæˆæ¬Šåå–®ã€çš„è³‡æ–™åº«ï¼ŒCI/CD æ˜¯ã€Œç§˜å¯†æ³¨å…¥è€…ã€

		âœ… JDBC æ˜¯ã€Œæˆæ¬Šåå–®ã€çš„è³‡æ–™åº«ï¼ŒCI/CD æ˜¯ã€Œç§˜å¯†æ³¨å…¥è€…ã€
			è·è²¬				èªªæ˜
			CI/CD / Vault		ç”¢å‡º & åˆ†ç™¼ client_id / client_secret çµ¦ client æœå‹™
			JDBC (Auth Server)	å„²å­˜å“ªäº› client æ˜¯åˆæ³•è¨»å†Šã€å…è¨±ä»€éº¼ grant typeã€scopeã€redirect uri
			Auth Server			æ ¹æ“š JDBC ä¸­çš„è³‡æ–™ä¾†é©—è­‰æ˜¯å¦å…è¨±é€™å€‹ client æ‹¿ token

	é¡æ¯”è§£é‡‹
		CI/CD = é‘°åŒ™å·¥å» ï¼Œè² è²¬åšå‡ºé‘°åŒ™ï¼ˆclient_id / secretï¼‰ä¸¦åˆ†ç™¼çµ¦å°æ‡‰ client
		JDBC = é–€é–æ¸…å–®ï¼Œè² è²¬åˆ—å‡ºå“ªäº›é‘°åŒ™æ˜¯åˆæ³•çš„ï¼Œå¯ä»¥æ‰“é–‹å“ªä¸€æ‰‡é–€ï¼ˆscope / redirect URI / grant typeï¼‰

		ä½ éœ€è¦å…©è€…æ­é…ï¼Œæ‰æ˜¯ä¸€å€‹å®‰å…¨è€Œå¯ç¶­è­·çš„ OAuth2 æ¶æ§‹ã€‚
âœ… æœ€ä½³å¯¦å‹™ç¸½çµ
	1.CI/CD æˆ– Vaultï¼šç”¢å‡º + ç®¡ç† + æ³¨å…¥ client_id / secret

	2.Spring Authorization Server å•Ÿå‹•æ™‚ï¼šè®€å–é€™äº›è³‡è¨Šè¨»å†Šåˆ° JDBC

	3.Client App å•Ÿå‹•æ™‚ï¼šé€é Vaultã€ç’°å¢ƒè®Šæ•¸ã€k8s Secret å–å¾—è‡ªå·±çš„æ†‘è­‰ä½¿ç”¨

	4.JDBC è³‡æ–™åº«ï¼šå”¯ä¸€çš„æˆæ¬Šä¾†æº + æ”¯æ´æŸ¥è©¢èˆ‡è®Šæ›´æ§åˆ¶


Q: æˆ‘ä¸èƒ½ä¸€ç›´å¾ MyAuthProperties è¨»å†Šåˆ° InMemory ?
	é€™ç¢ºå¯¦å¯ä»¥é‹ä½œï¼Œåªè¦åœ¨æ¯æ¬¡ Auth Server å•Ÿå‹•æ™‚ï¼ŒæŠŠ client é€é MyAuthProperties è¨»å†Šåˆ° InMemoryRegisteredClientRepositoryï¼Œä¾‹å¦‚ï¼š
		@Bean
		public RegisteredClientRepository registeredClientRepository(MyAuthProperties props, PasswordEncoder encoder) {
			List<RegisteredClient> clients = props.getClients().stream()
				.map(client -> RegisteredClient.withId(UUID.randomUUID().toString())
					.clientId(client.getClientId())
					.clientSecret(encoder.encode(client.getClientSecret()))
					.authorizationGrantType(AuthorizationGrantType.CLIENT_CREDENTIALS)
					.scopes(scopes -> scopes.addAll(client.getScopes()))
					.build()
				).toList();

			return new InMemoryRegisteredClientRepository(clients);
		}

A: ä½†é€™ç¨®ã€ŒInMemory æ¨¡å¼ã€æœ‰å¹¾å€‹æ˜ç¢ºé™åˆ¶ï¼š
	é™åˆ¶											èªªæ˜
	ç„¡æ³•å‹•æ…‹æ–°å¢/ä¿®æ”¹/æ’¤éŠ· client					è‹¥ä½ è¦æ–°å¢ä¸€å€‹ clientï¼Œè¦é‡æ–°éƒ¨ç½² Auth Server
	ç„¡æ³•èˆ‡ç®¡ç†å¾Œå°æ•´åˆ								ç®¡ç†è€…ä¸èƒ½é€é UI æ“ä½œæˆ–è³‡æ–™åº«ç›´æ¥ä¿®æ”¹æˆæ¬Šè³‡æ–™
	æ‰€æœ‰ secret å¿…é ˆç¡¬å¡åˆ° config / vault / env		secret lifecycle å…¨éƒ¨é  CI/CD æ§åˆ¶ï¼Œç¼ºä¹å¯è¦‹æ€§èˆ‡å¯å¯©æŸ¥æ€§
	ä¸åˆ©æ–¼æ©«å‘æ“´å±• Auth Server å¯¦ä¾‹					å¤šå€‹ Auth Server ç¯€é»æ™‚ï¼ŒInMemory å…§å®¹ç„¡æ³•å…±äº«


é è¨­è¡Œç‚ºï¼ˆSpring Authorization Server å…§å»ºï¼‰
	ç•¶ä½ æ²’æœ‰è‡ªè¨‚ä»»ä½•é‡‘é‘°æä¾›å™¨æ™‚ï¼ŒSpring Authorization Server æœƒï¼š
		1.åœ¨å•Ÿå‹•æ™‚è‡ªå‹•å‘¼å«å…§å»ºçš„ JwkSource<SecurityContext>
		2.ä½¿ç”¨ RSA ç”Ÿæˆä¸€å° 2048-bit é‡‘é‘°å°ï¼ˆKeyPairï¼‰
		3.åŒ…è£æˆ JWKSet æš´éœ²åœ¨ /oauth2/jwks endpoint
		4.ä½¿ç”¨ç§é‘°ç°½ç™¼ JWTï¼ˆRS256ï¼‰ï¼ŒResource Server å‰‡å¾ JWKS å–å¾—å…¬é‘°é©—è­‰

	å¯¦éš›é©—è­‰
		GET http://localhost:9000/oauth2/jwks
			{
			  "keys": [
				{
				  "kty": "RSA",
				  "e": "AQAB",
				  "n": "...",
				  "alg": "RS256",
				  "use": "sig",
				  "kid": "123abc..."
				}
			  ]
			}
	é€™å°±æ˜¯ Auth Server å…¬é–‹çš„ å…¬é‘°ï¼ˆJWKï¼‰ï¼ŒResource Server æœƒå¾é€™è£¡æŠ“ä¸‹ä¾†é©—ç°½ã€‚

	æ³¨æ„ï¼šé è¨­é‡‘é‘°æ˜¯æ¯æ¬¡å•Ÿå‹•éƒ½é‡æ–°ç”Ÿæˆ
		âœ… é©åˆé–‹ç™¼ã€æœ¬åœ°æ¸¬è©¦
		âŒ ä¸é©åˆæ­£å¼ç’°å¢ƒï¼ˆå› ç‚ºæ¯æ¬¡éƒ¨ç½²é‡‘é‘°æœƒè®Šï¼ŒèˆŠ JWT ç„¡æ³•é©—è­‰ï¼‰

	æ–¹å¼ä¸€ï¼šè‡ªå·±æä¾› RSA KeyPair
		@Bean
		public JWKSource<SecurityContext> jwkSource() {
			KeyPair keyPair = loadOrGenerateKeyPair();
			RSAKey rsaKey = new RSAKey.Builder((RSAPublicKey) keyPair.getPublic())
				.privateKey((RSAPrivateKey) keyPair.getPrivate())
				.keyID(UUID.randomUUID().toString())
				.build();
			return new ImmutableJWKSet<>(new JWKSet(rsaKey));
		}
		* KeyPair å¯ä»¥å¾é‡‘é‘°æª”ï¼ˆPEMï¼‰ã€keystoreã€Vault è¼‰å…¥

		* å¯é…åˆ CI/CD æˆ– Kubernetes secret ç®¡ç†é‡‘é‘°è¼ªæ›¿

	æ–¹å¼äºŒï¼šè¼‰å…¥å¤–éƒ¨é‡‘é‘°ï¼ˆå¦‚ JKS æˆ– PEMï¼‰
		Spring Authorization Server æ²’æœ‰ç›´æ¥æ”¯æ´è‡ªå‹•è¼‰å…¥ PEMï¼Œä½†ä½ å¯ä»¥ç”¨ Java æ–¹å¼è®€å…¥ï¼Œå†è½‰æˆ RSAKey

Q:å¯ä»¥åœ¨æ¯æ¬¡ä½ˆç½²æ™‚ï¼Œæ›´æ› auth server çš„é‡‘é‘°å°å—?
	æ½›åœ¨é¢¨éšªï¼ˆè‹¥æ¯æ¬¡éƒ¨ç½²éƒ½æ›é‡‘é‘°å°ï¼‰
	| å•é¡Œ                       | èªªæ˜                                     |
	| ------------------------ | -------------------------------------- |
	| âŒ èˆŠ JWT ç„¡æ³•é©—è­‰             | Resource Server é‚„æ”¶åˆ°èˆŠ tokenï¼Œä½†å·²ç„¡å°æ‡‰çš„å…¬é‘°å¯é©—è­‰ |
	| âŒ å¤š Resource Server åŒæ­¥å¤±æ•— | é‡‘é‘°è‹¥æœªçµ±ä¸€å…±ç”¨ï¼Œéƒ¨ç½²å¤šæœå‹™æœƒé€ æˆã€ŒA å¯é©—è­‰ï¼ŒB é©—è­‰å¤±æ•—ã€        |
	| âŒ åˆ†æ•£å¼æ¶æ§‹æœƒç™¼ç”Ÿ JWT é©—ç°½ä¸ä¸€è‡´     | åœ¨è² è¼‰å¹³è¡¡ï¼ˆå¤šå¯¦ä¾‹ï¼‰æ¶æ§‹ä¸‹ï¼Œtoken å¯èƒ½ç„¡æ³•è¢«æŸäº›ç¯€é»é©—è­‰        |

	æ­£ç¢ºä½œæ³•ï¼šé‡‘é‘°å›ºå®š + æœ‰è¨ˆç•«åœ°è¼ªæ›¿
		åšæ³•ä¸€ï¼šé‡‘é‘° å›ºå®šæ›è¼‰ï¼ˆä¸è®Šï¼‰
			æœ€ç°¡å–®ä¹Ÿæœ€ç©©å®šçš„åšæ³•ï¼š
				* ä½¿ç”¨å›ºå®šçš„ RSA é‡‘é‘°å°ï¼ˆPEMã€JKSã€Vault ç­‰ï¼‰
				* æ¯æ¬¡éƒ¨ç½²éƒ½è¼‰å…¥åŒä¸€ä»½é‡‘é‘°
				* JWT æ°¸é ç”¨é€™çµ„é‡‘é‘°ç°½ç™¼

			ğŸ“Œ é©ç”¨ï¼šå–®ç’°å¢ƒ / å…§éƒ¨ç³»çµ± / æœ‰ CI/CD secret ç®¡ç†

		 åšæ³•äºŒï¼šæ”¯æ´ Key Rotationï¼ˆé‡‘é‘°è¼ªæ›¿ï¼‰
			é€²éšå¯¦ä½œï¼š
			  1.æä¾›å¤šæŠŠé‡‘é‘°åœ¨ /oauth2/jwks ä¸­ï¼ˆä¾‹å¦‚ï¼šç›®å‰é‡‘é‘° + éæ¸¡æœŸé‡‘é‘°ï¼‰
			  2.æ¯æŠŠ JWK æœ‰å°æ‡‰çš„ kidï¼ˆkey IDï¼‰ï¼ŒJWT ä¸­æœƒå¸¶ä¸Š
			  3.Resource Server ä¾æ“š kid é¸æ“‡å°æ‡‰å…¬é‘°é©—ç°½
			  4.è¼ªæ›¿å¾Œé€æ­¥å°‡èˆŠé‡‘é‘°æ’¤é™¤

				// src/main/java/com/example/auth/config/JwkRotationConfig.java
				package com.example.auth.config;

				import com.nimbusds.jose.jwk.JWK;
				import com.nimbusds.jose.jwk.JWKSet;
				import com.nimbusds.jose.jwk.RSAKey;
				import org.springframework.context.annotation.Bean;
				import org.springframework.context.annotation.Configuration;
				import org.springframework.security.oauth2.server.authorization.config.annotation.web.configuration.OAuth2AuthorizationServerConfiguration;
				import org.springframework.security.oauth2.server.authorization.settings.AuthorizationServerSettings;
				import com.nimbusds.jose.jwk.source.ImmutableJWKSet;
				import com.nimbusds.jose.jwk.source.JWKSource;
				import com.nimbusds.jose.proc.SecurityContext;

				import java.security.KeyPair;
				import java.security.KeyPairGenerator;
				import java.util.List;
				import java.util.UUID;

				@Configuration
				public class JwkRotationConfig {

					@Bean
					public JWKSource<SecurityContext> jwkSource() throws Exception {
						// ğŸ”‘ ç›®å‰é‡‘é‘°
						RSAKey currentKey = generateRsaJwk("current-key-id");

						// ğŸ”‘ èˆŠé‡‘é‘°ï¼ˆé‚„åœ¨æœ‰æ•ˆæœŸï¼‰
						RSAKey previousKey = generateRsaJwk("previous-key-id");

						// ğŸ§© å°‡å¤šå€‹ JWK åŒ…è£æˆ JWKSet
						JWKSet jwkSet = new JWKSet(List.of(currentKey, previousKey));
						return new ImmutableJWKSet<>(jwkSet);
					}

					// éš¨æ©Ÿç”Ÿæˆç¯„ä¾‹
					private RSAKey generateRsaJwk(String keyId) throws Exception {
						KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("RSA");
						keyPairGenerator.initialize(2048);
						KeyPair keyPair = keyPairGenerator.generateKeyPair();

						return new RSAKey.Builder((java.security.interfaces.RSAPublicKey) keyPair.getPublic())
							.privateKey((java.security.interfaces.RSAPrivateKey) keyPair.getPrivate())
							.keyID(keyId)
							.build();
					}

					@Bean
					public AuthorizationServerSettings authorizationServerSettings() {
						return AuthorizationServerSettings.builder()
							.issuer("http://localhost:9000")
							.build();
					}
				}

				// å¾ å¤–éƒ¨æª”æ¡ˆ pem å–å¾—é‡‘é‘°å°
				// src/main/java/com/example/auth/config/JwkRotationConfig.java
				package com.example.auth.config;

				import com.nimbusds.jose.jwk.JWK;
				import com.nimbusds.jose.jwk.JWKSet;
				import com.nimbusds.jose.jwk.RSAKey;
				import com.nimbusds.jose.jwk.source.ImmutableJWKSet;
				import com.nimbusds.jose.jwk.source.JWKSource;
				import com.nimbusds.jose.proc.SecurityContext;
				import org.springframework.context.annotation.Bean;
				import org.springframework.context.annotation.Configuration;
				import org.springframework.security.oauth2.server.authorization.settings.AuthorizationServerSettings;

				import java.io.FileReader;
				import java.io.IOException;
				import java.nio.file.Paths;
				import java.security.interfaces.RSAPrivateKey;
				import java.security.interfaces.RSAPublicKey;
				import java.security.KeyFactory;
				import java.security.spec.PKCS8EncodedKeySpec;
				import java.security.spec.X509EncodedKeySpec;
				import java.security.KeyPair;
				import java.security.spec.InvalidKeySpecException;
				import java.util.Base64;
				import java.util.List;

				@Configuration
				public class JwkRotationConfig {

					@Bean
					public JWKSource<SecurityContext> jwkSource() throws Exception {
						// ğŸ” å¾ PEM è¼‰å…¥å…©çµ„é‡‘é‘°
						RSAKey currentKey = loadRsaKeyFromPem("keys/current-key", "current-key-id");

						File oldKeyFile = new File("src/main/resources/keys/previous-key.pem");
						if (oldKeyFile.exists()) {
							RSAKey previousKey = loadRsaKeyFromPem("keys/previous-key", "previous-key-id");
							keys.add(loadRsaKeyFromPem(...));
						}


						JWKSet jwkSet = new JWKSet(List.of(currentKey, previousKey));
						return new ImmutableJWKSet<>(jwkSet);
					}

					private RSAKey loadRsaKeyFromPem(String baseFileName, String keyId) throws Exception {
						RSAPrivateKey privateKey = loadPrivateKeyFromPem(baseFileName + ".pem");
						RSAPublicKey publicKey = loadPublicKeyFromPem(baseFileName + ".pub.pem");

						return new RSAKey.Builder(publicKey)
							.privateKey(privateKey)
							.keyID(keyId)
							.build();
					}

					private RSAPrivateKey loadPrivateKeyFromPem(String filepath) throws IOException, InvalidKeySpecException {
						String pem = readPem(filepath);
						String keyContent = pem.replace("-----BEGIN PRIVATE KEY-----", "")
							.replace("-----END PRIVATE KEY-----", "")
							.replaceAll("\\s", "");

						byte[] keyBytes = Base64.getDecoder().decode(keyContent);
						PKCS8EncodedKeySpec spec = new PKCS8EncodedKeySpec(keyBytes);
						KeyFactory kf = KeyFactory.getInstance("RSA");
						return (RSAPrivateKey) kf.generatePrivate(spec);
					}

					private RSAPublicKey loadPublicKeyFromPem(String filepath) throws IOException, InvalidKeySpecException {
						String pem = readPem(filepath);
						String keyContent = pem.replace("-----BEGIN PUBLIC KEY-----", "")
							.replace("-----END PUBLIC KEY-----", "")
							.replaceAll("\\s", "");

						byte[] keyBytes = Base64.getDecoder().decode(keyContent);
						X509EncodedKeySpec spec = new X509EncodedKeySpec(keyBytes);
						KeyFactory kf = KeyFactory.getInstance("RSA");
						return (RSAPublicKey) kf.generatePublic(spec);
					}

					private String readPem(String path) throws IOException {
						return new String(java.nio.file.Files.readAllBytes(Paths.get("src/main/resources/" + path)));
					}

					@Bean
					public AuthorizationServerSettings authorizationServerSettings() {
						return AuthorizationServerSettings.builder()
							.issuer("http://localhost:9000")
							.build();
					}
				}
				é æœŸçš„é‡‘é‘°æª”æ¡ˆæ”¾ç½®ä½ç½®
					src/main/resources/keys/
					â”œâ”€â”€ current-key.pem       â† ç§é‘°ï¼ˆPKCS#8 æ ¼å¼ï¼‰
					â”œâ”€â”€ current-key.pub.pem   â† å…¬é‘°ï¼ˆX.509 æ ¼å¼ï¼‰
					â”œâ”€â”€ previous-key.pem
					â””â”€â”€ previous-key.pub.pem


				ğŸ” å¦‚ä½•é€²è¡Œé‡‘é‘°è¼ªæ›¿ï¼ˆå»ºè­°æµç¨‹ï¼‰
					1.åŠ å…¥æ–°çš„é‡‘é‘°ï¼Œè®Šæˆï¼š[newKey, currentKey]
					2.è®“ Auth Server ç”¨ newKey ç™¼æ–°çš„ JWT
					3.ç­‰æ‰€æœ‰èˆŠ JWT éæœŸå¾Œï¼ˆä¾‹å¦‚é 1~2 å°æ™‚ï¼‰
					4.ç§»é™¤èˆŠé‡‘é‘°ï¼Œåªä¿ç•™ newKey
					ä½ å¯ä»¥å°‡ JWK ç®¡ç†æŠ½æˆé…ç½®æª”è¼‰å…¥ã€å¾æª”æ¡ˆ/DB/Vault å–é‡‘é‘°ï¼Œåšåˆ°è‡ªå‹•åŒ– key rotation

	ã€ŒçœŸæ­£çš„åˆ†æ•£å¼ç³»çµ±ï¼ˆæˆ–é«˜å¯ç”¨ç³»çµ±ï¼‰ä¸æœƒæ‰€æœ‰æœå‹™ä¸€èµ·ä¸Šä¸‹ç·šã€
		* å¯¦å‹™ä¸Šå¯èƒ½åªæœ‰ Auth Server éƒ¨ç½²æ–°ç‰ˆã€æˆ–æŸå€‹å¾®æœå‹™åšç†±éƒ¨ç½²
		* å‰ç«¯æˆ– cron job å¯èƒ½é‚„æŒæœ‰èˆŠ token
		* å¦‚æœé‡‘é‘°è®Šäº†ä½† Resource Server é‚„æ²’ reloadï¼Œå°±æœƒé©—è­‰å¤±æ•—

é è¨­ jwt
	| å•é¡Œ                      | å›ç­”                      |
	| ----------------------- | ----------------------- |
	| Spring Boot JWT é è¨­æœ‰æ•ˆå¤šä¹…ï¼Ÿ | âœ… 5 åˆ†é˜ï¼ˆaccess tokenï¼‰    |
	| å¯ä»¥ä¿®æ”¹å—ï¼Ÿ                  | âœ… å¯ä»¥ï¼Œé€é `tokenSettings` |
	| refresh token é è¨­å¤šä¹…ï¼Ÿ     | âœ… 60 åˆ†é˜ï¼Œå¯è‡ªè¨‚             |



Q: è‹¥ä¸æ˜¯ä½¿ç”¨ oauth2 æ¶æ§‹ï¼Œæ¯å€‹æœå‹™è‡ªå·±ç”¢ç”Ÿjwt é€åˆ°å¾Œç«¯æœå‹™æ™‚ï¼Œ å‰‡ jwt ç§é‘°æœƒæ•£è½åœ¨å„å€‹æœå‹™ä¸Šï¼Œä¸åˆ©æ–¼ç®¡ç†?
	ã€Œå¦‚æœä¸æ˜¯ä½¿ç”¨ OAuth2ï¼Œè€Œæ˜¯è®“æ¯å€‹æœå‹™å„è‡ªç”¢ç”Ÿ JWTï¼ˆè‡ªç°½ï¼‰ï¼Œé‚£éº¼ç§é‘°å°±æœƒæ•£è½åœ¨å„å€‹æœå‹™ä¹‹ä¸­ï¼Œé€ æˆï¼š
		âŒ é›£ä»¥ç®¡ç†ã€âŒ å®‰å…¨é¢¨éšªé«˜ã€âŒ è¼ªæ›¿å›°é›£ã€âŒ é©—è­‰ç„¡ä¸€è‡´æ€§ã€‚ã€

	å¦‚æœæ¯å€‹æœå‹™è‡ªå·±ç°½ç™¼ JWTï¼Œæœƒæœ‰é€™äº›å•é¡Œ
		| å•é¡Œé¡å‹          | æè¿°                                           |
		| ------------- | -------------------------------------------- |
		| ğŸ” ç§é‘°æ•£è½       | æ¯å€‹æœå‹™éƒ½è¦æœ‰è‡ªå·±çš„ç§é‘° â†’ å¯†é‘°æ•¸é‡å¤šï¼Œç®¡ç†æˆæœ¬é«˜                   |
		| ğŸ§¾ é©—è­‰ä¸ä¸€è‡´      | Resource Server å¿…é ˆçŸ¥é“ã€Œå“ªå€‹æœå‹™ç™¼çš„ token è¦ç”¨å“ªæŠŠå…¬é‘°ä¾†é©—è­‰ã€ |
		| ğŸ›‘ ç„¡æ³•æ’¤éŠ· token | æ²’æœ‰é›†ä¸­ç™¼è¡Œè€…ï¼Œä¸çŸ¥é“èª°ç™¼å‡ºä¾†çš„ token å¯ä¿¡ã€è¦ä¸è¦æ’¤æ‰              |
		| ğŸ”„ è¼ªæ›¿æ¥µé›£       | å¤šæœå‹™éƒ½æŒæœ‰é‡‘é‘°æ™‚ï¼Œè¼ªæ›¿æ™‚å¿…é ˆåŒæ­¥æ›´æ–° N å€‹æœå‹™ï¼Œå¾ˆå®¹æ˜“æ¼æ‰æˆ–ç™¼ç”Ÿä¸­æ–·         |
		| â“ ç„¡ç¨½å¯æŸ¥        | ç„¡ä¸­å¿ƒæ§ç®¡ï¼Œaudit logã€scope é™åˆ¶ã€ç”¨é€”å€éš”éƒ½ä¸æ¸…æ¥š            |

	ä½¿ç”¨ OAuth2 + Authorization Server çš„å„ªé»
		| å„ªé»             | æè¿°                                                    |
		| -------------- | ----------------------------------------------------- |
		| âœ… é‡‘é‘°é›†ä¸­         | JWT åªç”± Auth Server ç°½ç™¼ â†’ ç§é‘°é›†ä¸­æ§ç®¡ã€å®‰å…¨æ€§æ›´é«˜                  |
		| âœ… å…¬é‘°æ¨™æº–ç™¼ä½ˆï¼ˆJWKSï¼‰ | æ‰€æœ‰ Resource Server çµ±ä¸€å¾ `/.well-known/jwks.json` æŠ“å…¬é‘°é©—è­‰ |
		| âœ… Scope æ§ç®¡     | token å…§å®¹ç”± Auth Server çµ±ä¸€å®šç¾© scope / claimï¼Œæˆæ¬Šä¸€è‡´         |
		| âœ… Token è¼ªæ›¿å®¹æ˜“   | æ›é‡‘é‘°åªè¦æ›´æ–° Auth Serverï¼Œå…¶ä»– RS æœƒè‡ªå‹•æŠ“åˆ°æ–°å…¬é‘°                    |
		| âœ… å¤š client æ”¯æ´  | å„å‰ç«¯æˆ– backend åªæ‹¿ tokenï¼Œ**ä¸éœ€è¦çŸ¥é“ç°½åç§˜å¯†**                   |

	å°çµ
		| æ¶æ§‹æ–¹å¼                   | å®‰å…¨æ€§ | å¯ç¶­è­·æ€§  | é©ç”¨æƒ…å¢ƒ                 |
		| -------------------------- | --- | ----- | -------------------- |
		| æ¯å€‹æœå‹™è‡ªå·±ç”¢ JWT         | âŒ ä½ | âŒ é›£ç¶­è­· | demoã€å–®æ©Ÿç³»çµ±ã€ä¸æ•æ„Ÿè³‡æ–™å ´æ™¯    |
		| é›†ä¸­å¼ OAuth2 Auth Server  | âœ… é«˜ | âœ… æœ€ä½³  | æ­£å¼ç’°å¢ƒã€å¤šæœå‹™ã€å¤š client æ¶æ§‹ |

Q:å³ä½¿æ¯å€‹æœå‹™è‡ªå·±ç”¢ç”Ÿjwt é€åˆ°å¾Œç«¯æœå‹™ ç›¸é—œçš„è™•ç†æŠ½å‡ºé€šç”¨çš„å…ƒä»¶ï¼Œä»æœƒæœ‰ç›¸é—œç®¡ç†ä¸Šçš„å›°æ“¾?
	å³ä½¿ä½ å°‡ã€Œæ¯å€‹æœå‹™è‡ªå·±ç”¢ç”Ÿ JWTã€çš„è™•ç†é‚è¼¯æŠ½æˆå…±ç”¨å…ƒä»¶ï¼ˆlibraryï¼‰ï¼Œåœ¨å¯¦å‹™ä¸Šé‚„æ˜¯æœƒæœ‰ç®¡ç†ä¸Šçš„çµæ§‹æ€§å›°æ“¾ï¼Œä¸»è¦åŸå› æ˜¯ï¼šã€Œé‚è¼¯å…±ç”¨ â‰  å®‰å…¨æ²»ç†çµ±ä¸€ã€

	ç‚ºä»€éº¼æŠ½å…±ç”¨å…ƒä»¶é‚„æ˜¯æœƒæœ‰å•é¡Œï¼Ÿ
		| å•é¡Œé¡å‹                  | åŸå› èˆ‡èªªæ˜                                                     |
		| --------------------- | --------------------------------------------------------- |
		| ğŸ” **ç§é‘°æ•£å¸ƒ**           | å³ä½¿å…±ç”¨ libraryï¼Œç§é‘°ä»éœ€å­˜åœ¨æ–¼æ¯å€‹ç”¢ token çš„æœå‹™ä¸­ â†’ ä¸€æ¨£ã€Œæ¯å°æ©Ÿå™¨éƒ½æœ‰å¯†é‘°ã€çš„é¢¨éšªã€‚     |
		| ğŸ›¡ **è¼ªæ›¿å›°é›£**           | è¼ªæ›¿ç§é‘°æ™‚ï¼Œè¦åŒæ™‚éƒ¨ç½² N å€‹æœå‹™ï¼ˆæ›´æ–°é‡‘é‘°ï¼‰ï¼Œå¾ˆé›£åšåˆ°ç„¡ç¸«éæ¸¡èˆ‡é¢¨éšªéš”é›¢ã€‚                    |
		| ğŸ” **ç„¡æ³•é›†ä¸­ç¨½æ ¸**         | å› ç‚ºæ¯å€‹æœå‹™éƒ½èƒ½è‡ªå·±ç”¢ tokenï¼Œç„¡æ³•çŸ¥é“ã€Œèª°ç™¼çš„ã€ç‚ºä»€éº¼ç™¼ã€ç”¨äº†å“ªäº› claimã€ã€‚              |
		| ğŸ¯ **é©—è­‰é‚è¼¯ä¾è³´å‰ç½®æœå‹™**     | æ¯å€‹ Resource Server éœ€è¦çŸ¥é“è©² token æ˜¯å“ªå€‹æœå‹™ç™¼çš„ã€å°æ‡‰å“ªå€‹ keyï¼Œç„¡æ³•å–®ä¸€ä¾†æºé©—è­‰ã€‚ |
		| ğŸš« **Revocation ä¸å¯è¡Œ** | è‹¥æœ‰å®‰å…¨äº‹ä»¶ï¼ˆtoken æ´©æ¼ï¼‰ï¼Œç„¡æ³•é›†ä¸­æ’¤éŠ·æˆ–è¨­ blacklistï¼Œå› ç‚ºä½ ç”šè‡³ä¸çŸ¥é“æ˜¯èª°ç™¼çš„ã€‚         |
	æ¯”å–»ç†è§£ï¼ˆå…±ç”¨ library â‰  å®‰å…¨é›†ä¸­ï¼‰
		é€™å°±åƒä½ å…¬å¸è£¡çš„æ¯ä½å·¥ç¨‹å¸«éƒ½ç”¨åŒä¸€å¥—å¯†ç¢¼ç”¢ç”Ÿå™¨ç¨‹å¼ï¼ˆlibraryï¼‰ä¾†è¨­è¨ˆè‡ªå·±çš„å¤§é–€é‘°åŒ™ï¼Œä½†æ¯äººéƒ½è‡ªå·±ç®¡ç†é‚£æŠŠç§é‘°ğŸ”ï¼š
		ğŸ” å¯†ç¢¼ç”Ÿæˆç¨‹å¼ä¸€æ¨£ï¼ˆlibraryï¼‰

		âŒ ä½†æ¯æŠŠé‘°åŒ™éƒ½è‡ªå·±ä¿ç®¡ï¼ˆç§é‘°åˆ†æ•£ï¼‰

		ğŸ” æ²’æœ‰é‘°åŒ™ä¸­å¿ƒï¼Œä¸çŸ¥é“èª°é€²å‡ºå“ªè£¡

		ğŸ”„ æ›é–æ™‚è¦é€šçŸ¥æ¯å€‹äººåŒæ­¥æ›´æ–°æ‰€æœ‰é‘°åŒ™